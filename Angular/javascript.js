/*
GRANIFY_CONFIG = {
  SHOP_ID: 1381,
  cookies_domain: "hkexpress.com",
  use_iframe: false,
  use_cookies: true,
  cookie_fallback: false,
  analytics_tracker: [],
  local_jquery: false,
  session_tracking_type: "user_activity",
  migration_id: 1381,
  ssd_cart_item_info_properties: [ ]
  */

  GRANIFY_CONFIG = {

    cookies_domain: ".",
    use_iframe: false,
    use_cookies: true,
    cookie_fallback: false,
    analytics_tracker: [],
    local_jquery: false,


    ssd_cart_item_info_properties: [ ]
};
(function(){(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;l=this,b=void 0,r=function(e,t,n){var r,i;r=t&&n||0,i=0,t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=c[e])});while(i<16)t[r+i++]=0;return t},i=function(e,t){var n,r;return r=t||0,n=a,n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]},o=function(e,t,n){var r,s,o,u,a,f,l,c,h,p,d,v,m,g,y;u=t&&n||0,r=t||[],e=e!=null?e:{},l=e.node!=null?e.node:y,s=e.clockseq!=null?e.clockseq:v;if(l==null||s==null)h=b(),l==null&&(l=y=[h[0]|1,h[1],h[2],h[3],h[4],h[5]]);s==null&&(s=v=(h[6]<<8|h[7])&16383),a=e.msecs!=null?e.msecs:(new Date).getTime(),c=e.nsecs!=null?e.nsecs:g+1,o=a-m+(c-g)/1e4,o<0&&e.clockseq==null&&(s=s+1&16383),(o<0||a>m)&&e.nsecs==null&&(c=0);if(c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=a,g=c,v=s,a+=122192928e5,p=((a&268435455)*1e4+c)%4294967296,r[u++]=p>>>24&255,r[u++]=p>>>16&255,r[u++]=p>>>8&255,r[u++]=p&255,d=a/4294967296*1e4&268435455,r[u++]=d>>>8&255,r[u++]=d&255,r[u++]=d>>>24&15|16,r[u++]=d>>>16&255,r[u++]=s>>>8|128,r[u++]=s&255,f=0;while(f<6)r[u+f]=l[f],f++;return t?t:i(r)},u=function(t,n,r){var s,o,u;s=n&&r||0,typeof t=="string"&&(n=t==="binary"?new e(16):null,t=null),t=t||{},u=t.random||(t.rng||b)(),u[6]=u[6]&15|64,u[8]=u[8]&63|128;if(n){o=0;while(o<16)n[s+o]=u[o],o++}return n||i(u)};if(typeof l.require=="function")try{m=l.require("crypto").randomBytes,b=m&&function(){return m(16)}}catch(E){t=E}!b&&window.crypto&&window.crypto.getRandomValues&&(y=new Uint8Array(16),b=function(){return window.crypto.getRandomValues(y),y}),b||(g=new Array(16),b=function(){var e,t;e=0,t=void 0;while(e<16)(e&3)===0&&(t=Math.random()*4294967296),g[e]=t>>>(e&3)<<3&255,e++;return g}),e=typeof l.Buffer=="function"?l.Buffer:Array,a=[],c={},n=0;while(n<256)a[n]=(n+256).toString(16).substr(1),c[a[n]]=n,n++;w=b(),d=[w[0]|1,w[1],w[2],w[3],w[4],w[5]],f=(w[6]<<8|w[7])&16383,h=0,p=0,s=u,s.v1=o,s.v4=u,s.parse=r,s.unparse=i,s.BufferClass=e,v=l.uuid,s.noConflict=function(){return l.uuid=v,s},l.uuid=s}).call(Granify)}).call(this),function(){var e,t;Granify.determineStorageMethod=function(){var e,t,n;Granify.use_iframe=GRANIFY_CONFIG.use_iframe,Granify.use_local_storage=!GRANIFY_CONFIG.use_cookies,Granify.use_cookies=GRANIFY_CONFIG.use_cookies,Granify.localStorageWorking=!0,GRANIFY_CONFIG.cookie_fallback!=null?Granify.cookie_fallback=GRANIFY_CONFIG.cookie_fallback:Granify.cookie_fallback=Granify.use_cookies;try{window.localStorage.setItem("granify_localStorage_test","1"),window.localStorage.getItem("granify_localStorage_test")||(Granify.localStorageWorking=!1,window.localStorage.removeItem("granify_localStorage_test"))}catch(r){t=r,Granify.localStorageWorking=!1}if(!Granify.localStorageWorking){if(Granify.use_local_storage)return Granify.use_local_storage=!1;if(Granify.use_cookies&&!Granify.cookie_fallback)return document.cookie.indexOf("granify.localstorage_disabled")===-1&&(Granify._stack==null&&(Granify._stack=[]),Granify._stack.push(["error"].concat(new Error("Local Storage not enabled and no cookie fallback, disabling Granify matching"),"Initializer.js Detect Storage Method")),e=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",n=(new Date((new Date).getTime()+18e5)).toGMTString(),GLOBAL.document.cookie="granify.localstorage_disabled=true;expires="+n+";"+e+"path=/"),Granify.use_cookies=!1}},Granify.initializeCookieUUID=function(){var e,t,n,r,i;try{r=new RegExp("(?:^|[; ])granify\\.uuid=([^;]*)","g"),n=r.exec(GLOBAL.document.cookie),n&&(i=n[1])}catch(s){}return i?Granify.UUID=i:(Granify.UUID=Granify.uuid.v4(),e=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",t=(new Date("2020/01/01 00:00:00")).toGMTString(),document.cookie="granify.uuid="+Granify.UUID+";expires="+t+";"+e+"path=/")},Granify.initializeLocalStorageUUID=function(){var e,t,n;return n=window.localStorage.getItem("granify.uuid"),n?Granify.UUID=n:(Granify.UUID=Granify.uuid.v4(),t=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",e=JSON.stringify({expires:+(new Date("2020/01/01 00:00:00")),data:Granify.UUID}),window.localStorage.setItem("granify.uuid",e))},window.GLOBAL=window,window.parent!==window&&document.getElementById("js-iframe-async")&&(window.GLOBAL=window.parent),((e=GLOBAL.Granify)!=null?e.enabled:void 0)!=null?(window.Granify={},Granify.enabled=!1):(GLOBAL.Granify?window.Granify=GLOBAL.Granify:(window.Granify={},GLOBAL.Granify=window.Granify),Granify.enabled=!0,Granify.stopped=!1,Granify.trackers=[],Granify.tracker_classes=[],((t=GRANIFY_CONFIG.cookies_domain)!=null?t.trim().length:void 0)>0&&GRANIFY_CONFIG.cookies_domain!=="localhost"?Granify.cookies_domain="."+GRANIFY_CONFIG.cookies_domain.trim():Granify.cookies_domain="",Granify.determineStorageMethod(),Granify.use_cookies&&Granify.initializeCookieUUID(),Granify.use_local_storage&&Granify.initializeLocalStorageUUID())}.call(this),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n="0.7.17",r="",i="?",s="function",o="undefined",u="object",a="string",f="major",l="model",c="name",h="type",p="vendor",d="version",v="architecture",m="console",g="mobile",y="tablet",b="smarttv",w="wearable",E="embedded",S={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2===0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return typeof e=="string"?t.toLowerCase().indexOf(e.toLowerCase())!==-1:!1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:t},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},x={rgx:function(e,n){var r=0,i,o,a,f,l,c;while(r<n.length&&!l){var h=n[r],p=n[r+1];i=o=0;while(i<h.length&&!l){l=h[i++].exec(e);if(!!l)for(a=0;a<p.length;a++)c=l[++o],f=p[a],typeof f===u&&f.length>0?f.length==2?typeof f[1]==s?this[f[0]]=f[1].call(this,c):this[f[0]]=f[1]:f.length==3?typeof f[1]===s&&(!f[1].exec||!f[1].test)?this[f[0]]=c?f[1].call(this,c,f[2]):t:this[f[0]]=c?c.replace(f[1],f[2]):t:f.length==4&&(this[f[0]]=c?f[3].call(this,c.replace(f[1],f[2])):t):this[f]=c?c:t}r+=2}},str:function(e,n){for(var r in n)if(typeof n[r]===u&&n[r].length>0){for(var s=0;s<n[r].length;s++)if(S.has(n[r][s],e))return r===i?t:r}else if(S.has(n[r],e))return r===i?t:r;return e}},T={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},N={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[c,d],[/(opios)[\/\s]+([\w\.]+)/i],[[c,"Opera Mini"],d],[/\s(opr)\/([\w\.]+)/i],[[c,"Opera"],d],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[c,d],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[c,"IE"],d],[/(edge)\/((\d+)?[\w\.]+)/i],[c,d],[/(yabrowser)\/([\w\.]+)/i],[[c,"Yandex"],d],[/(puffin)\/([\w\.]+)/i],[[c,"Puffin"],d],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[c,"UCBrowser"],d],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],d],[/(micromessenger)\/([\w\.]+)/i],[[c,"WeChat"],d],[/(QQ)\/([\d\.]+)/i],[c,d],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[c,d],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[d,[c,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[d,[c,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[d,[c,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[c,/(.+)/,"$1 WebView"],d],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[c,/(.+(?:g|us))(.+)/,"$1 $2"],d],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[d,[c,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[c,d],[/(dolfin)\/([\w\.]+)/i],[[c,"Dolphin"],d],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[c,"Chrome"],d],[/(coast)\/([\w\.]+)/i],[[c,"Opera Coast"],d],[/fxios\/([\w\.-]+)/i],[d,[c,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[d,[c,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[d,c],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[c,"GSA"],d],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[c,[d,x.str,T.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[c,d],[/(navigator|netscape)\/([\w\.-]+)/i],[[c,"Netscape"],d],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[c,d]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,S.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[v,/ower/,"",S.lowerize]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[v,S.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,p,[h,y]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[p,"Apple"],[h,y]],[/(apple\s{0,1}tv)/i],[[l,"Apple TV"],[p,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[p,l,[h,y]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[l,[p,"Amazon"],[h,y]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[l,x.str,T.device.amazon.model],[p,"Amazon"],[h,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,p,[h,g]],[/\((ip[honed|\s\w*]+);/i],[l,[p,"Apple"],[h,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[p,l,[h,g]],[/\(bb10;\s(\w+)/i],[l,[p,"BlackBerry"],[h,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[l,[p,"Asus"],[h,y]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[p,"Sony"],[l,"Xperia Tablet"],[h,y]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[l,[p,"Sony"],[h,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[p,l,[h,m]],[/android.+;\s(shield)\sbuild/i],[l,[p,"Nvidia"],[h,m]],[/(playstation\s[34portablevi]+)/i],[l,[p,"Sony"],[h,m]],[/(sprint\s(\w+))/i],[[p,x.str,T.device.sprint.vendor],[l,x.str,T.device.sprint.model],[h,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[p,l,[h,y]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[p,[l,/_/g," "],[h,g]],[/(nexus\s9)/i],[l,[p,"HTC"],[h,y]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[l,[p,"Huawei"],[h,g]],[/(microsoft);\s(lumia[\s\w]+)/i],[p,l,[h,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[p,"Microsoft"],[h,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[p,"Microsoft"],[h,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[l,[p,"Motorola"],[h,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[p,"Motorola"],[h,y]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[p,S.trim],[l,S.trim],[h,b]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[p,"Samsung"],[h,b]],[/\(dtv[\);].+(aquos)/i],[l,[p,"Sharp"],[h,b]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[p,"Samsung"],l,[h,y]],[/smart-tv.+(samsung)/i],[p,[h,b],l],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[p,"Samsung"],l,[h,g]],[/sie-(\w+)*/i],[l,[p,"Siemens"],[h,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[p,"Nokia"],l,[h,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[l,[p,"Acer"],[h,y]],[/android.+([vl]k\-?\d{3})\s+build/i],[l,[p,"LG"],[h,y]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[p,"LG"],l,[h,y]],[/(lg) netcast\.tv/i],[p,l,[h,b]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[l,[p,"LG"],[h,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[p,"Lenovo"],[h,y]],[/linux;.+((jolla));/i],[p,l,[h,g]],[/((pebble))app\/[\d\.]+\s/i],[p,l,[h,w]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[p,l,[h,g]],[/crkey/i],[[l,"Chromecast"],[p,"Google"]],[/android.+;\s(glass)\s\d/i],[l,[p,"Google"],[h,w]],[/android.+;\s(pixel c)\s/i],[l,[p,"Google"],[h,y]],[/android.+;\s(pixel xl|pixel)\s/i],[l,[p,"Google"],[h,g]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w?)?[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[h,g]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+)?)\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[h,y]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[l,[p,"Meizu"],[h,y]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[l,[p,"OnePlus"],[h,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[l,[p,"RCA"],[h,y]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[l,[p,"Dell"],[h,y]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[l,[p,"Verizon"],[h,y]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[p,"Barnes & Noble"],l,[h,y]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[l,[p,"NuVision"],[h,y]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[p,"ZTE"],l,[h,y]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[l,[p,"Swiss"],[h,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[l,[p,"Swiss"],[h,y]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[l,[p,"Zeki"],[h,y]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[p,"Dragon Touch"],l,[h,y]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[l,[p,"Insignia"],[h,y]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[l,[p,"NextBook"],[h,y]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[p,"Voice"],l,[h,g]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[p,"LvTel"],l,[h,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[l,[p,"Envizen"],[h,y]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[p,l,[h,y]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[l,[p,"MachSpeed"],[h,y]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[p,l,[h,y]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[l,[p,"Rotor"],[h,y]],[/android.+(KS(.+))\s+build/i],[l,[p,"Amazon"],[h,y]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[p,l,[h,y]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[h,S.lowerize],p,l],[/(android.+)[;\/].+build/i],[l,[p,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[d,[c,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[c,d],[/rv\:([\w\.]+).*(gecko)/i],[d,c]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[c,d],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[d,x.str,T.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[d,x.str,T.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],d],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[c,d],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[c,"Symbian"],d],[/\((series40);/i],[c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],d],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[c,d],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],d],[/(sunos)\s?([\w\.]+\d)*/i],[[c,"Solaris"],d],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[c,d],[/(haiku)\s(\w+)/i],[c,d],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[d,/_/g,"."],[c,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[c,"Mac OS"],[d,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[c,d]]},C=function(n,i){typeof n=="object"&&(i=n,n=t);if(this instanceof C){var s=n||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:r),o=i?S.extend(N,i):N;return this.getBrowser=function(){var e={name:t,version:t};return x.rgx.call(e,s,o.browser),e.major=S.major(e.version),e},this.getCPU=function(){var e={architecture:t};return x.rgx.call(e,s,o.cpu),e},this.getDevice=function(){var e={vendor:t,model:t,type:t};return x.rgx.call(e,s,o.device),e},this.getEngine=function(){var e={name:t,version:t};return x.rgx.call(e,s,o.engine),e},this.getOS=function(){var e={name:t,version:t};return x.rgx.call(e,s,o.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return s},this.setUA=function(e){return s=e,this},this}return(new C(n,i)).getResult()};C.VERSION=n,C.BROWSER={NAME:c,MAJOR:f,VERSION:d},C.CPU={ARCHITECTURE:v},C.DEVICE={MODEL:l,VENDOR:p,TYPE:h,CONSOLE:m,MOBILE:g,SMARTTV:b,TABLET:y,WEARABLE:w,EMBEDDED:E},C.ENGINE={NAME:c,VERSION:d},C.OS={NAME:c,VERSION:d},this.ua=(new C).getResult()}.call(Granify,window),function(){Granify.enabled&&(Granify.SHOP_ID=GRANIFY_CONFIG.SHOP_ID,Granify.use_local_jquery=GRANIFY_CONFIG.local_jquery,Granify.rb=function(){return this},Granify.rb.server_ga_stores=[],Granify.rb.matching_host="//matching.granify.com",Granify.rb.asset_host="//cdn.granify.com",Granify.rb.env="production",Granify.domain=Granify.rb.asset_host,Granify.rb.version={rb:"2018-03-20 21:17:23 +0000",js:173},Granify.rb.environment=function(e){return"production"===e},Granify.rb.get_analytics=function(){return Granify.analyticsID=GRANIFY_CONFIG.analytics_tracker})}.call(this),function(){Granify.enabled&&(Date.prototype.addDays=function(e){return this.setTime(this.getTime()+e*24*60*60*1e3),this},Date.prototype.addHours=function(e){return this.setTime(this.getTime()+e*60*60*1e3),this},Date.prototype.addSeconds=function(e){return this.setTime(this.getTime()+e*1e3),this},Granify.getFormattedDate=function(){var e;return e=new Date,e.getUTCFullYear()+"-"+("00"+(e.getUTCMonth()+1)).slice(-2)+"-"+("00"+e.getUTCDate()).slice(-2)+" "+("00"+e.getUTCHours()).slice(-2)+":"+("00"+e.getUTCMinutes()).slice(-2)+":"+("00"+e.getUTCSeconds()).slice(-2)},Granify.getExpiresDateByYear=function(e){var t;return t=new Date,t.setFullYear(e),t},Granify.getTimezone=function(){return-((new Date).getTimezoneOffset()/60)})}.call(this),function(){Granify.enabled&&(Granify.getStorageName=function(e){return Granify.isFunction(e.name)?e.name():e.name},Granify.getStorageExpiration=function(e){return Granify.isFunction(e.expires)?e.expires():e.expires},Granify.getStorageKeysForCookie=function(){return[Granify.keyname(Granify.getStorageName(Granify.storage.UUID)),Granify.keyname(Granify.getStorageName(Granify.storage.SESSION)),Granify.keyname(Granify.getStorageName(Granify.storage.FORCE_MATCHING))]},Granify.storage={MUTEX:{name:"mutex",expires:function(){return+(new Date).addSeconds(5)}},UUID:{name:"uuid"},SESSION:{name:"session"},THROW_ERRORS:{name:"throw_granify_errors"},DEBUG_LOG:{name:"debug_log"},TRACK_SENT_ERRORS:{name:"track_sent_errors",expires:Granify.getSessionExpiration},FORCE_MATCHING:{name:"force_matching_cid",expires:Granify.getSessionExpiration},BOOKMARKLET:{name:"granify_bookmarklet"},ENTRY_PAGE:{name:"entry_page"},ENTRY_PAGE_SENT:{name:"entry_page_sent"},ENTRY_REFERRER:{name:"entry_referrer"},ENTRY_REFERRER_SENT:{name:"entry_referrer_sent"},CHECK_IFRAME_COOKIES:{name:function(){return"check_cookies_"+Granify.start_time_fixed},expires:function(){return+(new Date).addSeconds(1)}},TRACK_PRODUCT:{name:function(){return"track_product"},expires:function(){return+(new Date).addDays(60)}},TRACK_PRODUCT_ROLLING_WINDOW:{name:"track_product_window"},TRACKED_CART_PRODUCTS:{name:"tracked_cart_products"},SSD_CACHE:{name:"site_state_data_cache"},SSD_M_CACHE:{name:"site_state_data_modifier_cache"},WSD_CACHE:{name:"widget_state_data_cache"},LAST_ORDER:{name:"last_order"},LAST_FAST_ORDER:{name:"last_fast_order"},UNCONFIRMED_ORDERS:{name:"unconfirmed_orders"},LAST_SERVER_TIME:{name:"last_server_time"},LAST_GA_FAST_ORDER:{name:"last_ga_fast_order"},GA_GROUP:{name:function(){return"ga_group:"+Granify.SHOP_ID},expires:function(){return+(new Date).addHours(.166)}},GA_CONTROL_GROUP:{name:function(){return"ga_cgroup:"+Granify.SHOP_ID},expires:function(){return+(new Date).addHours(.166)}}})}.call(this),function(){var e,t,n,r,i;window.is_ie8=!1,Granify.is_ie=!1,r=window.navigator.userAgent,e=r.indexOf("MSIE "),n=r.indexOf("Trident/");if(e>0||n>0)Granify.is_ie=!0,e>0?i=parseInt(r.substring(e+5,r.indexOf(".",e)),10):n>0&&(t=r.indexOf("rv:"),i=parseInt(r.substring(t+3,r.indexOf(".",t)),10)),i===8&&(window.is_ie8=!0),i<9&&(Granify.enabled=!1)}.call(this),function(){window.addGranifyListener=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!0):e.attachEvent("on"+t,n)},window.removeGranifyListener=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!0):e.detachEvent("on"+t,n)}}.call(this),function(){Granify.enabled&&(Granify.showDebug=function(e){var t,n,r,i,s,o,u;t=GLOBAL.document.getElementById("granify_debug"),t||(Granify.addStyleRules("#granify_debug{position:absolute;z-index:999999;top:0;left:0;width:800px;padding:10px;height:auto;border:1px solid red;background:rgba(0,0,0,.9);.log{border-bottom:1px solid #ccc;margin-bottom:10px;white-space:normal;&.info{color:lighten(#0F0,40%)}&.warn{color:lighten(#FF7F00,20%)}&.debug{color:#fff}&.error{color:lighten(#F00,40%)}.separator{height:5px;background-color:#fff;margin-bottom:10px}"),t=GLOBAL.document.createElement("div"),t.id="granify_debug",GLOBAL.document.body.appendChild(t)),i=GLOBAL.document.createElement("div"),i.className="separator",t.appendChild(i);if(e.logs){u=e.logs;for(s=0,o=u.length;s<o;s++)r=u[s],n=GLOBAL.document.createElement("div"),n.className="log "+r[0],n.innerHTML=r[0]+": "+r[1],t.appendChild(n)}if(e.error)return n=GLOBAL.document.createElement("div"),n.className="log error",n.innerHTML=e.error+"<br/>"+e.backtrace.join("<br/>"),t.appendChild(n)},Granify.testDebug=function(e){if(GLOBAL.$!=null&&Granify.test_mode)return GLOBAL.$("#test-errors").prepend(e+"<br>")})}.call(this),function(){"use strict";function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function f(e){u=e}function l(e){a=e}function m(){return function(){process.nextTick(S)}}function g(){return function(){o(S)}}function y(){var e=0,t=new p(S),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function b(){var e=new MessageChannel;return e.port1.onmessage=S,function(){e.port2.postMessage(0)}}function w(){return function(){setTimeout(S,1)}}function S(){for(var e=0;e<s;e+=2){var t=E[e],n=E[e+1];t(n),E[e]=undefined,E[e+1]=undefined}s=0}function x(){try{var e=require,t=e("vertx");return o=t.runOnLoop||t.runOnContext,g()}catch(n){return w()}}function N(e,t){var n=this,r=new this.constructor(O);r[A]===undefined&&tt(r);var i=n._state;if(i){var s=arguments[i-1];a(function(){G(i,r,s,n._result)})}else V(n,r,e,t);return r}function k(e){var t=this;if(e&&typeof e=="object"&&e.constructor===t)return e;var n=new t(O);return U(n,e),n}function O(){}function H(){return new TypeError("You cannot resolve a promise with itself")}function B(){return new TypeError("A promises callback cannot return that same promise.")}function j(e){try{return e.then}catch(t){return P.error=t,P}}function F(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function I(e,t,n){a(function(e){var r=!1,i=F(n,t,function(n){if(r)return;r=!0,t!==n?U(e,n):W(e,n)},function(t){if(r)return;r=!0,X(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,X(e,i))},e)}function q(e,t){t._state===_?W(e,t._result):t._state===D?X(e,t._result):V(t,undefined,function(t){U(e,t)},function(t){X(e,t)})}function R(e,n,r){n.constructor===e.constructor&&r===C&&constructor.resolve===L?q(e,n):r===P?X(e,P.error):r===undefined?W(e,n):t(r)?I(e,n,r):W(e,n)}function U(t,n){t===n?X(t,H()):e(n)?R(t,n,j(n)):W(t,n)}function z(e){e._onerror&&e._onerror(e._result),$(e)}function W(e,t){if(e._state!==M)return;e._result=t,e._state=_,e._subscribers.length!==0&&a($,e)}function X(e,t){if(e._state!==M)return;e._state=D,e._result=t,a(z,e)}function V(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+_]=n,i[s+D]=r,s===0&&e._state&&a($,e)}function $(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?G(n,r,i,s):i(s);e._subscribers.length=0}function J(){this.error=null}function Q(e,t){try{return e(t)}catch(n){return K.error=n,K}}function G(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=Q(r,i),o===K?(f=!0,u=o.error,o=null):a=!0;if(n===o){X(n,B());return}}else o=i,a=!0;n._state===M&&(s&&a?U(n,o):f?X(n,u):e===_?W(n,o):e===D&&X(n,o))}function Y(e,t){try{t(function(n){U(e,n)},function(n){X(e,n)})}catch(n){X(e,n)}}function et(){return Z++}function tt(e){e[A]=Z++,e._state=undefined,e._result=undefined,e._subscribers=[]}function nt(e){return(new ht(this,e)).promise}function it(e){var t=this;return i(e)?new t(function(n,r){var i=e.length;for(var s=0;s<i;s++)t.resolve(e[s]).then(n,r)}):new t(function(e,t){t(new TypeError("You must pass an array to race."))})}function ot(e){var t=this,n=new t(O);return X(n,e),n}function at(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ft(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ct(e){this[A]=et(),this._result=this._state=undefined,this._subscribers=[],O!==e&&(typeof e!="function"&&at(),this instanceof ct?Y(this,e):ft())}function pt(e,t){this._instanceConstructor=e,this.promise=new e(O),this.promise[A]||tt(this.promise),i(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),this.length===0?W(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&W(this.promise,this._result))):X(this.promise,dt())}function dt(){return new Error("Array Methods must be provided an Array")}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=0,o,u,a=function(t,n){E[s]=t,E[s+1]=n,s+=2,s===2&&(u?u(S):T())},c=typeof window!="undefined"?window:undefined,h=c||{},p=h.MutationObserver||h.WebKitMutationObserver,d=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",v=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",E=new Array(1e3),T;d?T=m():p?T=y():v?T=b():c===undefined&&typeof require=="function"?T=x():T=w();var C=N,L=k,A=Math.random().toString(36).substring(16),M=void 0,_=1,D=2,P=new J,K=new J,Z=0,rt=nt,st=it,ut=ot,lt=ct;ct.all=rt,ct.race=st,ct.resolve=L,ct.reject=ut,ct._setScheduler=f,ct._setAsap=l,ct._asap=a,ct.prototype={constructor:ct,then:C,"catch":function(e){return this.then(null,e)}};var ht=pt;pt.prototype._enumerate=function(){var e=this.length,t=this._input;for(var n=0;this._state===M&&n<e;n++)this._eachEntry(t[n],n)},pt.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===L){var i=j(e);if(i===C&&e._state!==M)this._settledAt(e._state,t,e._result);else if(typeof i!="function")this._remaining--,this._result[t]=e;else if(n===lt){var s=new n(O);R(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){t(e)}),t)}else this._willSettleAt(r(e),t)},pt.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===M&&(this._remaining--,e===D?X(r,n):this._result[t]=n),this._remaining===0&&W(r,this._result)},pt.prototype._willSettleAt=function(e,t){var n=this;V(e,undefined,function(e){n._settledAt(_,t,e)},function(e){n._settledAt(D,t,e)})};var vt=function(e){return function(){var t;if(typeof global!="undefined")t=global;else if(typeof self!="undefined")t=self;else try{t=Function("return this")()}catch(n){throw new Error("polyfill of Granify promise failed because global object is unavailable in this environment")}var r=t.Promise;if(r&&Object.prototype.toString.call(r.resolve())==="[object Promise]"&&!r.cast){typeof e!="undefined"&&(e.Promise=r);return}typeof e!="undefined"&&(e.Promise=lt)
}}(this),mt=vt;lt.Promise=lt,lt.polyfill=mt,typeof this!="undefined"&&(this.Promise=lt),mt()}.call(Granify),function(){var e,t,n,r,i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.iframeCallbacks={},e=["track_product","tracked_cart_products"],r=function(t){return t==null&&(t=""),!(i.call(e,t)>=0)},t=function(e){return e==null&&(e=""),Granify.isObject(e)&&(e=Granify.getStorageName(e)),Granify.keyname(e)},Granify.keyname=function(e){var t;return t="."+Granify.SHOP_ID,e==="uuid"&&(t=""),e==="uuid"?"granify.uuid":"granify."+e+t},Granify.setIframeData=function(e,t,n,r){return n==null&&(n=0),r==null&&(r="set"),Granify.isDate(n)&&(n=+n),Granify.execAfterFrameLoaded(function(){return typeof t=="object"&&(t=JSON.stringify(t)),Granify.frame.contentWindow.postMessage(""+r+":"+e+"="+t+"@"+n,"*")})},Granify.getToggle=function(e,t){return Granify.getIframeData(e,t,"get-toggle")},Granify.setToggle=function(e,t){return Granify.setIframeData(e,t,0,"set-toggle")},Granify.setSharedData=function(e,n,i){var s;i==null&&(i=null),Granify.isObject(e)&&i==null&&(i=Granify.getStorageExpiration(e)),e=t(e);if(Granify.use_iframe)return i===null&&(i=0),Granify.setIframeData(e,n,i);if(Granify.use_local_storage&&Granify.localStorageWorking)return Granify.setStorage(e,n,i);if(Granify.use_cookies)try{i===0&&(i=null);if(Granify.isCookieStorage(e))return Granify.setCookie(e,n,i);if(Granify.localStorageWorking)return Granify.setStorage(e,n,i);if(Granify.cookie_fallback&&r(e))return Granify.setCookie(e,JSON.stringify(n),i)}catch(o){return s=o,Granify.log_error("Can't persist "+e+" with value "+n)}},Granify.getIframeData=function(e,t,n){var r;return n==null&&(n="get"),(r=Granify.iframeCallbacks)[e]==null&&(r[e]=[]),Granify.iframeCallbacks[e].push(t),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+n+":"+e,"*")})},Granify.synchronousGetSharedData=function(e){e=t(e);if(Granify.use_local_storage&&Granify.localStorageWorking)return Granify.getStorage(e);if(Granify.use_cookies){if(Granify.isCookieStorage(e))return Granify.getCookie(e);if(Granify.localStorageWorking)return Granify.getStorage(e);if(Granify.cookie_fallback)return Granify.getCookieWithParsing(e)}},Granify.getSharedData=function(e,r){var i;return r==null&&(r=null),e=t(e),r?n(e,r):(i=new Granify.Promise(function(t){return n(e,t)}),i)},n=function(e,t){if(Granify.use_iframe)return Granify.getIframeData(e,t);if(Granify.use_local_storage&&Granify.localStorageWorking)return t(Granify.getStorage(e));if(Granify.use_cookies){if(Granify.isCookieStorage(e))return t(Granify.getCookie(e));if(Granify.localStorageWorking)return t(Granify.getStorage(e));if(Granify.cookie_fallback)return t(Granify.getCookieWithParsing(e))}},Granify.getCookieWithParsing=function(e){var t,n;n=Granify.getCookie(e);try{return Granify.isString(n)&&n!=="undefined"&&(n=JSON.parse(n)),n}catch(r){return t=r,Granify.log_error("Can't return cookie value from "+e),null}},Granify.eraseIframeData=function(e,t){return t==null&&(t="erase"),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+t+":"+e,"*")})},Granify.eraseSharedData=function(e){e=t(e);if(Granify.use_iframe)return Granify.eraseIframeData(e);if(Granify.use_local_storage&&Granify.localStorageWorking)return Granify.eraseStorage(e);if(Granify.use_cookies){if(Granify.isCookieStorage(e))return Granify.eraseCookie(e);if(Granify.localStorageWorking)return Granify.eraseStorage(e);if(Granify.cookie_fallback)return Granify.eraseCookie(e)}},Granify.messageDispatcher=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;if(!e.origin.match(/granify/)&&!e.origin.match(/localhost|localdocker/))return;r=e.data,Object.prototype.toString.call(r)==="[object String]"&&(a=r.match(/([\.\w]+):(.*)/));if(a){o=a[1],f=a[2];try{s=JSON.parse(f),s?f=s.data:f=null}catch(p){i=p}u=o.replace("."+Granify.SHOP_ID,""),f==="undefined"&&(f=Granify.getStorage(u)),u==="uuid"&&(n=Granify.getStorage(u),Granify.isString(n)&&n.length>0&&n!==f&&(f=n)),u==="granify.widget_state"&&typeof f=="object"&&(f=JSON.stringify(f));if(Granify.iframeCallbacks[o]){h=Granify.iframeCallbacks[o];for(l=0,c=h.length;l<c;l++){t=h[l];try{t&&t(f)}catch(p){i=p,Granify.error(i,"messageDispatch")}}return delete Granify.iframeCallbacks[o]}}},Granify.isCookieStorage=function(e){return e==null&&(e=""),Granify.KEYS_TO_COOKIE==null&&(Granify.KEYS_TO_COOKIE=Granify.getStorageKeysForCookie()),Granify.KEYS_TO_COOKIE.indexOf(e)>-1},addGranifyListener(window,"message",Granify.messageDispatcher))}.call(this),function(){Granify.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Granify.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},Granify.isBoolean=function(e){return e===!0||e===!1||Object.prototype.toString.call(e)==="[object Boolean]"},Granify.isNumber=function(e){return Object.prototype.toString.call(e)==="[object Number]"&&!isNaN(e)},Granify.isInteger=function(e){return Object.prototype.toString.call(e)==="[object Number]"&&isFinite(e)&&Math.floor(e)===e},Granify.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},Granify.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},Granify.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"},Granify.isPromise=function(e){return Object.prototype.toString.call(e)==="[object Promise]"},Granify.safeCastToInteger=function(e){var t;return Granify.isString(e)&&(t=Number(e)),Granify.isInteger(t)?t:null},Granify.safeCastToFloat=function(e){var t;return Granify.isString(e)&&(t=Number(e)),Granify.isNumber(t)?t:null}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.compact_object=function(e){var t,n,r,i,s,o,u,a;Granify.isArray(e)?r=[]:r={};if(typeof e=="object"){e=Granify.packObj(e);for(s in e){o=e[s];if(typeof o=="number"&&o!==0||typeof o=="string"&&o.length!==0)r[s]=o;else if(Granify.isArray(o)){t=[];for(u=0,a=o.length;u<a;u++)i=o[u],n=Granify.compact_object(i),n!=null&&t.push(n);t.length>0&&(r[s]=t)}else typeof o=="object"&&o!=null&&(n=Granify.compact_object(o),n!=null&&JSON.stringify(n)!=="{}"&&(r[s]=n))}}return r},Granify.reduce_precision=function(e){var t,n,r;t={};for(n in e)r=e[n],t[n]={d:Granify.round(r.d),t:Granify.round(r.t),s:Granify.round(r.s),a:Granify.round(r.a),c:Granify.round(r.c)},r.e!=null&&(t[n].e=r.e);return t},Granify.reduce_ms_precision=function(e){var t,n,r,i,s;Granify.isArray(e)?t=[]:t={};for(n in e){i=e[n];if(typeof i=="object"&&!Granify.isArray(i)){t[n]={};for(r in i)s=i[r],isNaN(s)&&(s=0),t[n][r]=parseFloat(Granify.round(s))}else t[n]=i}return t},Granify.data_aliases={id:"i",session:"s",class_name:"cn",uuid:"id",site_id:"sid",cart_contents:"cc",add_to_cart:"ac",delete_from_cart:"dc",start_time:"st",visit_duration:"vd",status:"sts",page_type:"pt",page_meta_data:"pm",mouse_distance:"md",scroll_distance:"sd",scroll_depth:"sh",tab_changes:"tc",mouse_heatmap:"mh",mouse_stats:"ms",timezone:"tz",source:"src",referer:"ref",service:"srv",query:"qry",current_time:"ct",medium:"me",content:"co",campaign:"ca",term:"te",over:"ov",text:"tx",links:"lk",images:"im",other:"oh",time:"tm",buttons:"bu",selections:"sel",click:"cl",copied_text:"cx",orig_length:"ol",path:"p",scroll_top:"sc",viewport:"v",tags:"t",category:"cat",subcategory:"scat",data:"dt",name:"n",price:"pr",widget_latency_full:"wlf",widget_latency_js:"wlj",entry_page:"ep",entry_referrer:"er",has_unconfirmed_orders:"uo",mouse_active_time:"ma",time_since_start:"tss",time_since_dom:"tsd"},Granify.packObj=function(t){var n,r,i,s;Granify.isArray(t)?r=[]:r={};for(n in t){i=t[n],s=["timezone","items"];if((i==null||i===""||i===0||i.length===0||i==="{}")&&e.call(s,n)<0)continue;Granify.data_aliases[n]!=null?Granify.isNumber(i)?r[Granify.data_aliases[n]]=Granify.round(i):Granify.isObject(i)?r[Granify.data_aliases[n]]=Granify.packObj(i):r[Granify.data_aliases[n]]=i:r[n]=i}return r},Granify.removeUnchangedData=function(t){var n,r,i;if(Granify.latestSentData){r=["uuid","session","site_id","start_time","visit_duration","tags","x","current_time","has_unconfirmed_orders","force_matching"],n={};for(i in t)if(e.call(r,i)>=0||t[i]!==Granify.latestSentData[i])n[i]=t[i];return n}return t}}.call(this),function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Granify.strDiff=function(e,t){return e.length>t.length?e.replace(t,""):t.replace(e,"")},Granify.isLocationChanged=function(e){var t;return t=Granify.strDiff(e,GLOBAL.location.href),t!==""&&t!=="#"&&t!=="#."}}.call(this),function(){Granify.roundProperty=function(e,t){if(e)return e[t]=Granify.round(e[t])},Granify.round=function(e){var t;return t=e||0,Granify.isNumber(e)&&(t=parseFloat(Granify.roundOnePlace(e))),t},Granify.isRounded=function(e){return Granify.isNumber(e)?10*e-parseInt(10*e)===0:!1},Granify.roundAllProperties=function(e){var t,n,r;e==null&&(e=Granify),r=[];for(t in e)n=e[t],Granify.isNumber(n)?Granify.isRounded(n)?r.push(void 0):r.push(Granify.roundProperty(n)):Granify.isObject(n)?r.push(Granify.roundAllProperties(n)):r.push(void 0);return r},Granify.roundOnePlace=function(e){return Math.round(e*10)/10}}.call(this),function(){Granify.enabled&&(Granify.throttle=function(e,t,n){var r,i,s,o,u,a;return i=r=u=a=null,o=0,n||(n={}),s=function(){var t;return o=(t=n.leading===false)!=null?t:{0:new Date},a=null,u=e.apply(i,r)},function(){var f,l;return f=new Date,!o&&n.leading===!1&&(o=f),l=t-(f-o),i=this,r=arguments,l<=0?(clearTimeout(a),a=null,o=f,u=e.apply(i,r)):!a&&n.trailing!==!1&&(a=setTimeout(s,l)),u}})}.call(this),function(){Granify.enabled&&(Granify.getDocumentHeight=function(){var e;return e=GLOBAL.document,Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.body.clientHeight,e.documentElement.clientHeight)},Granify.getDocumentWidth=function(){var e,t;return(typeof GLOBAL!=="undefined"&&GLOBAL!==null?(t=GLOBAL.document)!=null?t.body:void 0:void 0)==null?0:(e=GLOBAL.document,Math.max(e.body.scrollWidth,e.documentElement.scrollWidth,e.body.offsetWidth,e.documentElement.offsetWidth,e.body.clientWidth,e.documentElement.clientWidth))},Granify.ValidIpAddressRegex=/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/,Granify.forceSecureProtocol=function(e){return e||Granify.log_error("Granify.forceSecureProtocol was passed an invalid value, url is undefined"),e.match(/localhost|localdocker/)||e.match(Granify.ValidIpAddressRegex)?e:e.indexOf("//")===0?"https:"+e:e.replace("http://","https://")},Granify.insertFrame=function(){var e;return e=document.getElementsByTagName("body")[0],e?(Granify.frame=document.createElement("iframe"),Granify.frame.src=Granify.forceSecureProtocol(Granify.domain)+("/identifier.html?matching="+Granify.matching),Granify.frame.style.display="none",Granify.frame.title="Granify identifier",addGranifyListener(Granify.frame,"load",function(){return Granify.frameLoaded=!0}),e.appendChild(Granify.frame)):setTimeout(Granify.insertFrame,100)},Granify.insertStylesheet=function(e,t,n){var r;return t==null&&(t=""),n==null&&(n=function(){}),r=GLOBAL.document.createElement("link"),r.rel="stylesheet",r.type="text/css",r.className=t,r.href=e,r.onload=n,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.addStyleRules=function(e,t){var n;return t==null&&(t="granify-style-sheet"),n=document.createElement("style"),n.className=t,n.type="text/css",is_ie8?n.styleSheet.cssText=e:n.innerHTML=e,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(n)},Granify.insertScript=function(e,t,n){var r;return t==null&&(t=function(){}),n==null&&(n=null),r=GLOBAL.document.createElement("script"),r.src=e,n&&(r.id=n),r.readyState?r.onreadystatechange=function(){if(r.readyState==="loaded"||r.readyState==="complete")return r.onreadystatechange=function(){},t()}:r.onload=function(){return t()},GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.execAfterDOMAvailable=function(e){return GLOBAL.document.readyState==="complete"||!is_ie8&&document.readyState==="interactive"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMAvailable(e)},100)},Granify.execAfterDOMLoaded=function(e){return GLOBAL.document.readyState==="complete"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMLoaded(e)},100)},Granify.execAfterFrameLoaded=function(e){return Granify.frameLoaded||!Granify.use_iframe?e.call(this):setTimeout(function(){return Granify.execAfterFrameLoaded(e)},100)},Granify.createXPathFromElement=function(e){var t,n,r;n=[];while(e&&e.nodeType===1){if(typeof e.hasAttribute=="function"?e.hasAttribute("id"):void 0)n.unshift("id("+e.getAttribute("id")+")");else if(typeof e.hasAttribute=="function"?e.hasAttribute("class"):void 0)n.unshift(e.nodeName.toLowerCase()+"[@class="+e.getAttribute("class")+"]");else{r=e.previousSibling,t=1;while(r)r.nodeName===e.nodeName&&t++,r=r.previousSibling;n.unshift(e.nodeName.toLowerCase()+"["+t+"]")}e=e.parentNode}return n.length?"/"+n.join("/"):null})}.call(this),function(){Granify.enabled&&(Granify.getParam=function(e,t,n){var r,i,s,o,u,a,f,l;t==null&&(t=null),n==null&&(n=window.location.search),Granify.isArray(n)?(s=[],n.forEach(function(e){return s.push((e.split("?")[1]||e.replace("?","")).split("&"))})):s=(n.split("?")[1]||n.replace("?","")).split("&"),o=null;for(a=0,f=s.length;a<f;a++)r=s[a],Granify.isString(r)?(l=r.split("="),i=l[0],u=l[1]):i=r[0],e===i&&(o=u||!0);return o||t},Granify.paramExists=function(e,t){return t==null&&(t=window.location.search),!!Granify.getParam(e,!1,t)},Granify.removeParam=function(e,t){var n;return t==null&&(t=window.location.search),!Granify.isString(t)||t.indexOf("?")!==0?null:(n=Granify.getParam(e,null,t))===null?null:t.replace(RegExp(""+e+"="+n+"&?"),"").replace(/[?&]$/,"")},Granify.removeQueryParamFromUrl=function(e,t){var n,r,i,s,o,u;t==null&&(t=window),n=t!=null?(o=t.location)!=null?o.href:void 0:void 0,s=t!=null?(u=t.location)!=null?u.search:void 0:void 0;if(!Granify.isString(s)||!Granify.isString(n)||n.indexOf(s)===-1)return Granify.log_error("Granify.removeQueryParamFromUrl: Invalid URL and/or query string params - assure query string is contained within URL",{url:n,queryString:s});if((r=Granify.removeParam(e,s))===null)return;return i=n.replace(s,r),t.history.replaceState(t.history.state,null,i),Granify.location=i})}.call(this),function(){var e={}.hasOwnProperty;Granify.enabled&&(Granify.hashToQuery=function(t){var n,r,i;r=[];for(n in t){if(!e.call(t,n))continue;i=t[n],i!==void 0&&r.push(""+n+"="+encodeURIComponent(i))}return r.join("&")},Granify.JSONP=function(e,t,n,r){var i,s;return t==null&&(t={}),r==null&&(r=!0),i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script"),r&&(s.async="async"),s.charset="UTF-8",t.callback="granify_cb_"+ +(new Date),window[t.callback]=n,s.src=e+"?"+Granify.hashToQuery(t),s.onload=function(){return i.removeChild(s)},i.insertBefore(s,i.firstChild)},Granify.AJAX=function(e,t,n){var r;return t==null&&(t={}),n==null&&(n=function(){}),r=new XMLHttpRequest,e=e+"?"+Granify.hashToQuery(t),r.onreadystatechange=function(){var e;if(r.readyState===4&&r.status===200)return e=(new Function("return "+r.responseText))(),n(e)},r.open("GET",e,!0),r.send()},Granify.POST=function(e,t,n,r){var i,s,o;t==null&&(t={}),n==null&&(n=function(){}),r==null&&(r=function(){});try{return s=JSON.stringify(t),o=new XMLHttpRequest,o.onreadystatechange=function(){var e;if(o.readyState===4)return o.status===200?(e=(new Function("return "+o.responseText))(),n(e)):r()},o.open("POST",e,!0),o.setRequestHeader("Content-type","text/plain"),o.send(s)}catch(u){return i=u,Granify.error(i,"POST"),r()}})}.call(this),function(){var e,t={}.hasOwnProperty;Granify.enabled&&(Granify.not_synced_errors=[],Granify.last_error_sync=null,e=function(e){var t,n,r;n=0,r=void 0,t=void 0;if(e.length===0)return n;r=0;while(r<e.length)t=e.charCodeAt(r),n=(n<<5)-n+t,n|=0,r++;return n},Granify._check_debug_query=function(e){var t,n;e==null&&(e=window);if(((n=e.location)!=null?n.search:void 0)==null)return Granify.setSharedData(Granify.storage.DEBUG_LOG,!1);t=Granify.getParam("granify_debug",null,e.location.search);if(t==="true")return Granify.setSharedData(Granify.storage.DEBUG_LOG,!0);if(t==="false")return Granify.setSharedData(Granify.storage.DEBUG_LOG,!1)},Granify._should_use_debug_log=function(){return Granify.use_iframe==null||!Granify.use_iframe?!!Granify.synchronousGetSharedData(Granify.storage.DEBUG_LOG):!0},Granify.setDebugLogging=function(e){return Granify.isBoolean(e)&&Granify.setSharedData(Granify.storage.DEBUG_LOG,e),Granify._should_use_debug_log()},Granify.log=function(){if(Granify._should_use_debug_log())return console.log.apply(console,arguments)},Granify.error=function(e,t){var n,r;n={name:""+t+"-"+e.name+"-"+Granify.ua.browser.name+"-"+Granify.version.js,message:e.message,version:Granify.version.rb,stack:(r=e.stack)!=null?r.toString():void 0,column:e.columnNumber,site_id:Granify.SHOP_ID,UUID:Granify.UUID,session:Granify.SESSION,context_data:e.context_data,env:Granify.rb.env},Granify.log("Granify.error: ",n.name,n.message),Granify.not_synced_errors.push(n),Granify.errors.push(""+n.name+" - "+n.message),Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(n));if(Granify.throw_errors)throw e;return Granify.syncErrors()},Granify.syncErrors=function(){var e;if(Granify.not_synced_errors.length===0)return;if(new Date-Granify.last_error_sync<1e3)return;return Granify.last_error_sync=new Date,Granify.not_synced_errors.length>5&&(e=Granify.not_synced_errors.length,Granify.not_synced_errors=Granify.not_synced_errors.slice(0,5),Granify.log_error("More then 5 errors per second",{errors_count:e})),Granify.POST(""+Granify.matching+"/error",{errors:JSON.stringify(Granify.not_synced_errors)}),Granify.not_synced_errors=[],setTimeout(function(){return Granify.syncErrors()},1e3)},Granify.log_error=function(t,n,r){var i,s,o;n==null&&(n={});if(!Granify.send_validation_errors)return;o=Granify.synchronousGetSharedData(Granify.storage.TRACK_SENT_ERRORS),o||(o={}),s=e(t);if(!r||!o.hasOwnProperty(s)){Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(n));try{throw new Error}catch(u){i=u,i.name=t,n&&(i.message=typeof JSON!="undefined"&&JSON!==null?JSON.stringify(n):void 0),Granify.error(i,"log_error");if(r)return o[s]=!0,Granify.setSharedData(Granify.storage.TRACK_SENT_ERRORS,o)}}},Granify.testsDebug=function(e){if(Granify.testsDebugMessages!=null)return Granify.testsDebugMessages.push(e)},Granify.addErrorHandling=function(e){var n,r,i;i=[];for(r in e){if(!t.call(e,r))continue;n=e[r],typeof n=="function"&&r!=="rb"&&r!=="error"&&r!=="addErrorHandling"&&r!=="uuid"&&r!=="Promise"?i.push(e[r]=function(t,n){return function(){var r;try{return n.apply(e,arguments)}catch(i){return r=i,Granify.error(r,""+t)}}}(r,n)):i.push(void 0)}return i})}.call(this),function(){Granify.enabled&&(Granify.getCookie=function(e){var t,n,r,i;try{return i=[],r=new RegExp("[; ]"+e+"=([^\\s;]*)","ig"),n=("; "+document.cookie).match(r)||[],n.length===1?i.push(decodeURIComponent(n[0].split("=")[1])):n.length>1&&(n.forEach(function(e){return i.push(decodeURIComponent(e.split("=")[1]))}),Granify.log_error("Multiple cookie occurrences",{key:e,value:i[0],values:i})),i[0]}catch(s){return t=s,Granify.log_error("Error reading cookie",{key:e,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:t.message}),void 0}},Granify.setCookie=function(e,t,n){var r,i,s,o,u;r=6307e7;try{return n==null&&(n=new Date(+(new Date)+r)),i=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",o=encodeURIComponent(t),u=Granify.isNumber(n)?new Date(n):n,GLOBAL.document.cookie=""+e+"="+o+";expires="+u.toGMTString()+";"+i+"path=/"}catch(a){return s=a,Granify.log_error("Error writing cookie",{key:e,writeValue:o,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:s.message})}},Granify.eraseCookie=function(e){var t,n;try{return t=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",GLOBAL.document.cookie=""+e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"+t+"path=/"}catch(r){return n=r,Granify.log_error("Error deleting cookie",{key:e,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:n.message})}})}.call(this),function(){Granify.enabled&&(Granify.getStorage=function(e){var t,n,r,i;if(!Granify.localStorageWorking)return;Granify.isObject(e)&&(e=Granify.getStorageName(e),e=Granify.keyname(e)),i=null;try{r=JSON.parse(window.localStorage.getItem(e)),r&&(r.expires!=null?(n=r.expires,parseInt(n)>+(new Date)?i=r.data:(i=null,Granify.eraseStorage(e))):(i=null,Granify.eraseStorage(e)))}catch(s){t=s,t instanceof SyntaxError?Granify.log_error("Error parsing local storage value into JSON",{key:e,value:i,clientDate:new Date,location:location.toString(),exceptionMsg:t.message}):Granify.log_error("Error reading value from local storage",{key:e,clientDate:new Date,location:location.toString(),exceptionMsg:t.message})}return i},Granify.setStorage=function(e,t,n){var r,i,s;if(!Granify.localStorageWorking)return;try{return Granify.isObject(e)&&(n||(n=Granify.getStorageExpiration(e)),e=Granify.getStorageName(e),e=Granify.keyname(e)),r=6307e7,n==null&&(n=new Date(+(new Date)+r)),i=JSON.stringify({expires:+n,data:t}),window.localStorage.setItem(e,i)}catch(o){return s=o,Granify.log_error("Error writing value to local storage",{key:e,writeValue:i,clientDate:new Date,location:location.toString(),exceptionMsg:s.message})}},Granify.eraseStorage=function(e){var t;if(!Granify.localStorageWorking)return;try{return Granify.isObject(e)&&(e=Granify.getStorageName(e),e=Granify.keyname(e)),window.localStorage.removeItem(e)}catch(n){return t=n,Granify.log_error("Error deleting value from local storage",{key:e,clientDate:new Date,location:location.toString(),exceptionMsg:t.message})}})}.call(this),function(){var e,t,n,r,i,s,o,u;t=5120,n=10240,e="cart_item_info",i=[],s=null,o=null,u=null,Granify.getSSDLimit=function(){return t},Granify.getWSDLimit=function(){return n},Granify.updateStateDataFromStorage=function(){return s=Granify.synchronousGetSharedData(Granify.storage.SSD_CACHE)||null,o=Granify.synchronousGetSharedData(Granify.storage.SSD_M_CACHE)||null,u=Granify.synchronousGetSharedData(Granify.storage.WSD_CACHE)||null},Granify.getSSD=function(){return s!=null?s:null},Granify.getSSD_M=function(){return o!=null?o:null},Granify.getWSD=function(){return u!=null?u:null},Granify.clearSSD=function(){return s=null,Granify.eraseSharedData(Granify.storage.SSD_CACHE)},Granify.clearSSD_M=function(){return o=null,Granify.eraseSharedData(Granify.storage.SSD_M_CACHE)},Granify.clearWSD=function(){return u=null,Granify.eraseSharedData(Granify.storage.WSD_CACHE)},Granify.enableSiteStateData=function(){var e,t,n,r;t=GRANIFY_CONFIG.ssd_cart_item_info_properties,i=[];if(!Granify.isArray(t)){Granify.log_error("SSD: Expected 'ssd_cart_item_info_properties' from Dashboard to be an array",{dashboard_properties:t},!0);return}for(n=0,r=t.length;n<r;n++)e=t[n],Granify.isString(e)?i.push(e):Granify.log_error("Entry in 'ssd_cart_item_info_properties' is not String, not using for ssd property",{entry:e})},Granify.setCartSSDProperty=function(t){var n;n=r(t,i);if(n!=null&&Object.keys(n).length>0)return Granify.setSiteStateDataProperty(e,n)},Granify.setCartSSDModifierProperty=function(t){var n;n=r(t,i);if(n!=null&&Object.keys(n).length>0)return Granify.setSiteStateDataModifierProperty(e,n)},r=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;u={},a={};if(t==null||t.length<=0)return null;r=e.map(function(e){return e.id});for(f=0,c=r.length;f<c;f++){n=r[f],i={};for(l=0,h=t.length;l<h;l++)s=t[l],o=Granify.getProduct(n,s),o!=null?i[s]=o:(u[n]==null&&(u[n]=[]),u[n].push(s));Object.keys(i).length>0&&(a[n]=i)}return Object.keys(u).length>0&&Granify.log_error("Missing properties for one or more cart items - cannot send with site_state_data",u,!0),a},Granify.setSiteStateDataProperty=function(e,t){if(!Granify.isString(e)){Granify.log_error("Expected site_state_data 'property_key' to be a string",{property_key:e});return}return s=Granify.getSSD()||{},s[e]=t,Granify.setSharedData(Granify.storage.SSD_CACHE,s)},Granify.setSiteStateDataModifierProperty=function(e,t){if(!Granify.isString(e)){Granify.log_error("Expected ssd_modifier 'property_key' to be a string",{property_key:e});return}if(!Granify.isObject(t)){Granify.log_error("Expected ssd_modifier 'property_value' to be a hash",{property_value:t});return}return o=Granify.getSSD_M()||{},o[e]=t,Granify.setSharedData(Granify.storage.SSD_M_CACHE,o)},Granify.setWidgetStateProperty=function(e,t){if(!Granify.isString(e)){Granify.log_error("Expected 'property_key' to be a string for widget_state_data",{property_key:e});return}return u=Granify.getWSD()||{},u[e]=t,Granify.setSharedData(Granify.storage.WSD_CACHE,u)}}.call(this),function(){Granify.enabled&&(Granify.events==null&&(Granify.events={}),Granify.trigger=function(e){var t;return(t=Granify.events)[e]==null&&(t[e]={}),Granify.events[e].triggered=!0,Granify.triggerEventCallbacks(e)},Granify.triggerEventCallbacks=function(e){var t,n,r,i;if(!(typeof Granify!="undefined"&&Granify!==null?(i=Granify.events[e])!=null?i.callbacks:void 0:void 0))return;r=[];while(Granify.events[e].callbacks.length>0)try{n=Granify.events[e].callbacks.pop(),n.callback.apply(),n.type==="repeat"&&r.push(n)}catch(s){t=s,typeof callback!="undefined"&&callback!==null&&Granify.error(t,"Event callback error: "+e+",  "+callback.toString())}return Granify.events[e].callbacks=r},Granify.on=function(e,t){var n,r;(n=Granify.events)[e]==null&&(n[e]={}),(r=Granify.events[e])["callbacks"]==null&&(r.callbacks=[]),Granify.events[e].callbacks.push({type:"once",callback:t});if(Granify.events[e].triggered)return Granify.triggerEventCallbacks(e)},Granify.onEvery=function(e,t){var n,r;return(n=Granify.events)[e]==null&&(n[e]={}),(r=Granify.events[e])["callbacks"]==null&&(r.callbacks=[]),Granify.events[e].callbacks.push({type:"repeat",callback:t})})}.call(this),function(){Granify.enabled&&(Granify.isMutexLocked=function(){return Granify.synchronousGetSharedData(Granify.storage.MUTEX)!=null},Granify.lockMutex=function(){return Granify.setSharedData(Granify.storage.MUTEX,1)},Granify.releaseMutex=function(){return Granify.eraseSharedData(Granify.storage.MUTEX)},Granify.waitForMutex=function(e){return Granify.isMutexLocked()?setTimeout(function(){return Granify.waitForMutex(e)},100):e()})}.call(this),function(){var e,t,n,r,i;e=1800,Granify.session_expiration_delta=GLOBAL._test_session_expiration_delta||e,Granify.session_type=GRANIFY_CONFIG.session_tracking_type?GRANIFY_CONFIG.session_tracking_type:"user_activity",n=function(){return Granify.session_type==="page"},r=function(){return Granify.session_type==="user_activity"},i=(new Date).getTime(),t=function(){return i==null&&(i=(new Date).getTime()),i},Granify.updatePageLoadTime=function(){return i=(new Date).getTime()},Granify.getSessionExpiration=function(){return n()?t()+Granify.session_expiration_delta*1e3:r()?+(new Date).addSeconds(Granify.session_expiration_delta):(Granify.log_error("Unknown session_type, defaulting to User Activity style",{session_type:Granify.session_type},!0),+(new Date).addSeconds(Granify.session_expiration_delta))},Granify.sessionHasExpired=function(){return Granify.getSessionExpiration()<new Date}}.call(this),function(){var e;Granify.enabled&&(e=function(){function e(){this.start()}return e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.reset=function(){},e.prototype.getData=function(){return{}},e}(),Granify.Tracker=e)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(e=function(e){function p(){return t=p.__super__.constructor.apply(this,arguments),t}var n,s,o,u,a,f,l,c,h=this;return r(p,e),p.prototype.start=function(){var e,t,n,r,i,s,o;try{e=this,this.reset(),Granify.lastBlockTrack=new Date,is_ie8?r=GLOBAL.document:r=GLOBAL,addGranifyListener(GLOBAL.document,"mousemove",c),o=["mouseover","mouseout","mouseup","click"];for(i=0,s=o.length;i<s;i++)n=o[i],addGranifyListener(r,n,a);return addGranifyListener(GLOBAL,"scroll",l),addGranifyListener(GLOBAL,"copy",f)}catch(u){return t=u,Granify.error(t,"mouseTracker-start")}},l=Granify.throttle(function(){var e,t,n,r;if(Granify.stopped||GLOBAL.document.body==null)return;return t=((n=GLOBAL.document)!=null?(r=n.documentElement)!=null?r.scrollTop:void 0:void 0)||GLOBAL.document.body.scrollTop,Granify.scroll_distance+=Math.abs(Granify.prev_scroll_top-t),Granify.prev_scroll_top=t,e=(t+GLOBAL.innerHeight)/Granify.getDocumentHeight()*100,e=Granify.round(e),Granify.scroll_depth=e>Granify.scroll_depth?e:Granify.scroll_depth,Granify.idle_time=0,Granify.lastScroll=new Date},100),c=function(e){var t;if(Granify.stopped)return;t=e||GLOBAL.event;if(is_ie8&&typeof e.clientX=="unknown")return;try{return n(),o(e.pageX||e.clientX,e.pageY||e.clientY)}catch(r){return e=r,Granify.error(e,"getMouseStats")}},o=Granify.throttle(function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;a=e-Granify.prev_mouse_pos.x,f=t-Granify.prev_mouse_pos.y,Granify.mouse_distance+=Math.sqrt(a*a+f*f),Granify.prev_mouse_pos.y?n=Math.abs(t-Granify.prev_mouse_pos.y):n=0,l=Granify.getDocumentWidth()/2,s=Math.floor(Math.abs(l-e)/50),o=Math.floor(t/50),e<l?i="L":i="R",r=i+s.toString()+"x"+o.toString(),Granify.mouse_heatmap[r]==null&&(Granify.mouse_heatmap[r]={},Granify.mouse_heatmap[r].t=0,Granify.mouse_heatmap[r].d=0,Granify.mouse_heatmap[r].c=0),u=Math.sqrt(a*a+f*f),c=u*10,n=(c-Granify.prev_mouse_pos.s)/10,isNaN(c)&&(c=0),isNaN(n)&&(n=0),Granify.mouse_heatmap[r].d+=u,Granify.mouse_heatmap[r].s=c,Granify.mouse_heatmap[r].a=n,Granify.prev_mouse_pos={x:e,y:t,s:Granify.mouse_heatmap[r].s,a:Granify.mouse_heatmap[r].a,block:r},Granify.idle_time=0;if(GLOBAL.document.body){Granify.scrollTop=GLOBAL.document.body.scrollTop||GLOBAL.document.documentElement.scrollTop,h=l-350,p=50;if(e<h&&t-Granify.scrollTop<p)return Granify.mouse_heatmap[r].e=1}},100),a=function(e){var t,n,r,i,o;if(Granify.stopped)return;t=e||GLOBAL.event,n=e.type,r=e.target||e.srcElement,i=e.pageX||e.clientX,o=e.pageY||e.clientY;try{return s(n,r,i,o)}catch(u){return e=u,Granify.error(e,"mouse_context")}},s=Granify.throttle(function(e,t,n,r){var s,o,a,f,l,c,h,p;n==null&&(n=0),r==null&&(r=0),l=["B","P","STRONG","DIV","SPAN","I","EM","LI"],f=t.tagName;switch(e){case"click":c="click",s=1;break;case"mouseover":Granify.event_start_time=(new Date).getTime(),c="over",s=1;break;case"mouseout":c="time",Granify.event_start_time?s=((new Date).getTime()-Granify.event_start_time)/1e3:s=0;break;default:c="selection"}c==="selection"&&GLOBAL.getSelection!=null&&u()!==""&&(Granify.mouse_stats.selections+=1);if(c==="click"){a={},a.path=Granify.createXPathFromElement(t),a.id=t.id,a.class_name=t.className,a.time=Granify.round((new Date).getTime()/1e3),a.x=parseInt(n),a.y=parseInt(r);if(f==="A"||f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON"))a.text=t.innerText;Granify.mouse_stats.clicks.push(a),o=Granify.prev_mouse_pos.block,o&&o!==""&&Granify.mouse_heatmap&&Granify.mouse_heatmap[o]&&((h=Granify.mouse_heatmap[o]).c==null&&(h.c=0),Granify.mouse_heatmap[o].c+=1)}if(typeof Granify!="undefined"&&Granify!==null?!Granify.mouse_stats:!void 0)Granify.mouse_stats={};return Granify.mouse_stats[c]||(Granify.mouse_stats[c]={links:0,text:0,images:0,buttons:0,other:0}),f==="A"?Granify.mouse_stats[c].links+=s:i.call(l,f)>=0&&((p=t.children)!=null?p.length:void 0)===0&&t.innerText!==""?Granify.mouse_stats[c].text+=s:f==="IMG"?Granify.mouse_stats[c].images+=s:f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON")?Granify.mouse_stats[c].buttons+=s:Granify.mouse_stats[c].other+=s},100),n=function(){var e,t,n,r,i;return i=Granify.getDocumentWidth()/2,n=Math.floor(Math.abs(i-Granify.prev_mouse_pos.x)/50),r=Math.floor(Granify.prev_mouse_pos.y/50),Granify.prev_mouse_pos.x<i?t="L":t="R",e=t+n.toString()+"x"+r.toString(),Granify.mouse_heatmap[e]==null&&(Granify.mouse_heatmap[e]={},Granify.mouse_heatmap[e].t=0,Granify.
mouse_heatmap[e].d=0),Granify.tracking_stopped||(Granify.mouse_heatmap[e].t+=(new Date-Granify.lastBlockTrack)/1e3),Granify.lastBlockTrack=new Date},u=function(){var e,t,n,r,i,s;try{n="";if(GLOBAL.getSelection!=null){s=GLOBAL.getSelection();if(s.rangeCount){e=GLOBAL.document.createElement("div"),r=0,i=s.rangeCount;while(r<i)e.appendChild(s.getRangeAt(r).cloneContents()),++r;n=e.innerHTML}}else GLOBAL.document.selection!=null&&GLOBAL.document.selection.type==="Text"&&(n=GLOBAL.document.selection.createRange().htmlText);return n}catch(o){return t=o,""}},f=function(e){var t;if(Granify.stopped)return;try{if(GLOBAL.document.getSelection)return t={text:GLOBAL.document.getSelection().toString().replace(/[\"\\\']/gi,"").substring(0,140),orig_length:GLOBAL.document.getSelection().toString().length},Granify.mouse_stats.copied_text.push(t)}catch(n){return e=n,Granify.error(e,"getMouseCopy")}},p.prototype.stop=function(){var e,t,n,r,i,s;try{is_ie8?n=GLOBAL.document:n=GLOBAL,removeGranifyListener(GLOBAL.document,"mousemove",this.handleStats),s=["mouseover","mouseout","mouseup","click"];for(r=0,i=s.length;r<i;r++)t=s[r],removeGranifyListener(n,t,this.handleMouseContext);return removeGranifyListener(GLOBAL,"scroll",this.handleScroll),removeGranifyListener(GLOBAL,"copy",this.handleMouseCopy)}catch(o){return e=o,Granify.error(e,"mouseTracker-stop")}},p.prototype.reset=function(){var e,t,n,r,i,s,o,u,a,f,l,c;Granify.scroll_distance=0,Granify.scroll_depth=0,Granify.prev_scroll_top=0,Granify.mouse_distance=0,Granify.prev_mouse_pos={x:0,y:0,s:(o=typeof Granify!=="undefined"&&Granify!==null?(u=Granify.prev_mouse_pos)!=null?u.s:void 0:void 0)!=null?o:0,a:(a=typeof Granify!=="undefined"&&Granify!==null?(f=Granify.prev_mouse_pos)!=null?f.a:void 0:void 0)!=null?a:0},Granify.mouse_heatmap={},Granify.mouse_stats={},Granify.mouse_stats.selections=0,l=["over","click","time"];for(n=0,i=l.length;n<i;n++){t=l[n],Granify.mouse_stats[t]={},c=["text","links","images","buttons","other"];for(r=0,s=c.length;r<s;r++)e=c[r],Granify.mouse_stats[t][e]=0}return Granify.mouse_stats.copied_text=[],Granify.mouse_stats.clicks=[]},p.prototype.getData=function(){var e,t,n,r,i,s,o;try{return t={mouse_distance:Granify.mouse_distance!=null?Granify.round(Granify.mouse_distance):0,scroll_distance:(n=Granify.scroll_distance)!=null?n:0,scroll_depth:(r=Granify.scroll_depth)!=null?r:0,mouse_heatmap:(i=JSON.stringify(Granify.compact_object(Granify.reduce_precision(Granify.mouse_heatmap))))!=null?i:"{}",mouse_stats:(s=JSON.stringify(Granify.compact_object(Granify.reduce_ms_precision(Granify.mouse_stats))))!=null?s:"{}",scroll_top:(o=Granify.prev_scroll_top)!=null?o:0},Granify.mouse_heatmap={},Granify.mouse_stats.clicks=[],t}catch(u){return e=u,Granify.error(e,"mouseTracker-getData"),{}}},p}.call(this,Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(e=function(e){function i(){return t=i.__super__.constructor.apply(this,arguments),t}var n;return r(i,e),i.prototype.start=function(){var e;try{return addGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-start")}},n=Granify.throttle(function(){return Granify.idle_time=0},100),i.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-stop")}},i}(Granify.Tracker))}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(e=function(e){function r(){return this.handler=n(this.handler,this),t=r.__super__.constructor.apply(this,arguments),t}return i(r,e),r.prototype.start=function(){var e;try{return this.reset(),GLOBAL.document.hidden!=null?(this.hidden="hidden",this.visibilityChange="visibilitychange"):GLOBAL.document.mozHidden!=null?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):GLOBAL.document.msHidden!=null?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):GLOBAL.document.webkitHidden!=null&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),addGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-start")}},r.prototype.handler=function(){var e;try{if(Granify.stopped)return;return GLOBAL.document[this.hidden]?(Granify.tab_changes+=1,Granify.page_visit+=((new Date).getTime()-Granify.start_time)/1e3):Granify.start_time=(new Date).getTime()}catch(t){return e=t,Granify.error(e,"handleVisibilityChange")}},r.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-stop")}},r.prototype.getReferrer=function(){var e,t,n;if(((n=GLOBAL.document)!=null?n.referrer:void 0)==null){Granify.log_error("Unable to determine referrer, GLOBAL.document.referrer is falsey");return}try{e=decodeURI(GLOBAL.document.referrer)}catch(r){t=r,e=decodeURI(unescape(GLOBAL.document.referrer).replace(/%/g,"")).replace(/(http|https):\/\//,"")}return e.replace(/(http|https):\/\//,"")},r.prototype.getData=function(){var e,t,n;try{return Granify.referrer==null&&(Granify.referrer=this.getReferrer()),GLOBAL.location.origin||(GLOBAL.location.origin=GLOBAL.location.protocol+"//"+GLOBAL.location.hostname+(GLOBAL.location.port?":"+GLOBAL.location.port:"")),t=GLOBAL.location.toString().replace(GLOBAL.location.origin,""),{tab_changes:(n=Granify.tab_changes)!=null?n:0,viewport:JSON.stringify({h:Math.max(GLOBAL.document.documentElement.clientHeight,GLOBAL.innerHeight||0),w:Math.max(GLOBAL.document.documentElement.clientWidth,GLOBAL.innerWidth||0)}),timezone:Granify.getTimezone(),referer:Granify.referrer,path:t}}catch(r){return e=r,Granify.error(e,"browserTracker-getData")}},r.prototype.reset=function(){return Granify.tab_changes=0},r}(Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){Granify.enabled&&(Granify.setData=function(e,t){return Granify.data||(Granify.data={}),Granify.data[e]=t},Granify.time_since=function(e){return((new Date).getTime()-e)/1e3})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.getGaAttributes=function(){var e,t,n,r,i,s,o,u,a,f,l;try{s=new RegExp("(?:^|\\W)__utmz=([^;]*)","g"),r=s.exec(GLOBAL.document.cookie),r&&(u=decodeURI(r[1]));if(u!=null&&u.length>0){t={},l=u.split(".").slice(4).join(".").split("|");for(a=0,f=l.length;a<f;a++)i=l[a],o=i.split("="),t[o[0]]=o[1],t[o[0]]!=null&&(t[o[0]]=t[o[0]].replace(/\(/,""),t[o[0]]=t[o[0]].replace(/\)/,""));return n={},t.utmcmd!=null&&(n.medium=t.utmcmd),t.utmcsr!=null&&(n.source=t.utmcsr),t.utmcct!=null&&(n.content=t.utmcct.replace(/\t|\r|\n/gm,"")),t.utmccn!=null&&(n.campaign=t.utmccn),t.utmctr!=null&&(n.term=t.utmctr.replace(/\t|\r|\n/gm,"")),n}return{}}catch(c){e=c}return Granify.error(e,"getGaAttributes")},Granify.shouldTrackGa=function(){return Granify.analyticsID.length>0},Granify.loadGaTracking=function(){var e,t,n,r,i;if(typeof granifyGA!="undefined"&&granifyGA!==null||!Granify.shouldTrackGa())return;t=GLOBAL.GoogleAnalyticsObject,t&&GLOBAL[t]&&Granify.isFunction(GLOBAL[t])?window.granifyGA=GLOBAL[t]:function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","granifyGA"),e=Granify.analyticsID,i=[],n=0;while(n<e.length)r=e[n],i.push(granifyGA("create",r[0],{name:"granifyTracker"+n})),n++;return i},Granify.trackGaEvent=function(e,t,n){var r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),l=Granify.analyticsID,c=[];for(r=a=0,f=l.length;a<f;r=++a){u=l[r],s=u[1],i=u[2];if(e==="customer"&&!i)continue;if(e==="message"&&t==="control-group"&&!s)continue;o={},u[4]&&(o.nonInteraction=1),c.push(granifyGA("granifyTracker"+r+".send","event",e,t,n,o))}return c},Granify.sendGaGroup=function(e){return Granify.getSharedData(Granify.storage.GA_GROUP).then(function(t){if(!t)return Granify.trackGaEvent("customer","group",e),Granify.setSharedData(Granify.storage.GA_GROUP,"1")})},Granify.sendGaOrder=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),r=(e.total_price||0)-(e.subtotal_price||0)-(e.total_tax||0),r<0&&(r=0),f=Granify.analyticsID,c=[];for(t=s=0,u=f.length;s<u;t=++s){i=f[t];if(!i[3])continue;granifyGA("granifyTracker"+t+".require","ecommerce","ecommerce.js"),granifyGA("granifyTracker"+t+".ecommerce:addTransaction",{id:String(e.order_number),affiliation:String(Granify.SHOP_ID),revenue:String(e.subtotal_price||0),shipping:String(r),tax:String(e.total_tax||0),currency:e.currency||"USD"});if(e.line_items){l=e.line_items;for(o=0,a=l.length;o<a;o++)n=l[o],granifyGA("granifyTracker"+t+".ecommerce:addItem",{id:String(e.order_number),name:String(n.name),sku:String(n.product_id),category:"General",price:String(n.price||0),quantity:String(n.quantity||0),currency:e.currency||"USD"})}c.push(granifyGA("granifyTracker"+t+".ecommerce:send"))}return c},Granify.on("offer:shown",function(){var e;e=Granify.old_offer,console.log("trackGaEvent offer:shown "+e.id+":"+e.outcome.headline);if(Granify.previewMode||Granify.previewModeWithMatching)return;return Granify.trackGaEvent("message","shown",""+e.id+":"+e.outcome.headline)}),Granify.on("control_group",function(){return Granify.getSharedData(Granify.storage.GA_CONTROL_GROUP).then(function(e){if(!e)return Granify.trackGaEvent("message","control-group","not-shown"),Granify.setSharedData(Granify.storage.GA_CONTROL_GROUP,"1")})}),Granify.shouldTrackGaOnServerSide=function(){var t;return Granify.shouldTrackGa()?(t=Number(Granify.SHOP_ID),e.call(Granify.rb.server_ga_stores,t)>=0):!1})}.call(this),function(){Granify.initCoupon=function(e){return Granify.savedCallback=e,Granify.use_local_jquery&&GLOBAL.jQuery?(Granify.JQ=GLOBAL.jQuery,Granify.savedCallback()):Granify.insertScript("https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js",function(){return Granify.JQ=GLOBAL.jQuery.noConflict(!0),Granify.savedCallback()})}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.checkOrderParameters=function(e){var t;return t=new Granify.Promise(function(t){return e.client_order_date=parseInt(+(new Date).getTime()/1e3),Granify.getSharedData(Granify.storage.LAST_SERVER_TIME).then(function(t){return t!=null&&t.time!=null&&Granify.SESSION!=null&&t.session===Granify.SESSION&&(e.order_date=t.time),Granify.pageType="receipt",e.site_id=Granify.SHOP_ID,Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.UUID)}).then(function(t){return e.uuid=Granify.UUID||t,Granify.shouldTrackGaOnServerSide()&&(e.track_ga=!0),e["financial_status"]==null&&(e.financial_status="paid"),e.financial_status=e.financial_status.toLowerCase(),(e!=null?e.subtotal_price:void 0)!=null&&e["total_line_items_price"]==null&&(e.total_line_items_price=e.subtotal_price),Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.SESSION)}).then(function(n){var r,i,s,o,u,a,f,l;e.session=Granify.SESSION||n,e.method="post",f=["currency","subtotal_price","order_number"];for(s=0,u=f.length;s<u;s++){r=f[s];if(!(e[r]!=null&&e[r].toString().length>0)){Granify.log_error(r+" is required !",e),e=null;break}}e["items"]!=null&&e["line_items"]==null&&(e.line_items=e.items,delete e.items);if(e["line_items"]!=null){l=e.line_items;for(o=0,a=l.length;o<a;o++){i=l[o],i.product_id==null&&(i.product_id=i.id);if(!(i.product_id!=null&&i.product_id.toString().length>0)){Granify.log_error("product_id is required !",e),e=null;break}i.variant_id!=null&&i.variant_id.toString().length>0||(i.variant_id="null")}}return t(e)})}),t},Granify.trackOrder=function(e,t){var n;return t==null&&(t=!1),Granify.log("GRANIFY - trackOrder() called with: ",e),t?(n={},Granify.checkOrderParameters(e).then(function(e){if(e)return Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_FAST_ORDER)}).then(function(t){return!e.order_number||t===e.order_number?Granify.Promise.reject():(Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var n;return n=t||[],n.push(e),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,n),Granify.hasUnconfirmedOrders=!0}),n.site_id=Granify.SHOP_ID,Granify.Promise.resolve(e))}).then(function(){return Granify.getSharedData(Granify.storage.UUID)}).then(function(t){return n.uuid=Granify.UUID||t,Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.SESSION)}).then(function(t){var r,i;return n.session=Granify.SESSION||t,n.order_number=e.order_number,n.subtotal_price=e.subtotal_price,n.total_price=e.total_price,n.currency=e.currency,n.item_count=((i=e["line_items"])!=null?i.length:void 0)||0,n.method="jsonp",Granify.shouldTrackGaOnServerSide()&&(n.track_ga=!0),n.stopped=Granify.stopped,r=""+Granify.matching+"/javascript/orders/fast-update",Granify.JSONP(r,n,function(e){if(e.error!=null)return Granify.JSONP(r,n,function(e){})}),Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_ORDER)}).then(function(t){return Granify.SESSION_INITIALIZED===1&&!n.track_ga&&t!==e.order_number&&(Granify.sendGaOrder(n),Granify.setSharedData(Granify.storage.LAST_GA_FAST_ORDER,n.order_number)),Granify.setSharedData(Granify.storage.LAST_FAST_ORDER,n.order_number)})["catch"](function(){})):Granify.reloadFlags(function(){var t;try{return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(t){return!e.order_number||t===e.order_number?Granify.Promise.reject():Granify.Promise.resolve(e)}).then(function(){return Granify.getSharedData(Granify.storage.LAST_FAST_ORDER)}).then(function(t){return t!==e.order_number&&Granify.trackOrder(e,!0),Granify.Promise.resolve(e)}).then(function(){return Granify.checkOrderParameters(e)}).then(function(e){var t;return e?(e.stopped=Granify.stopped,t=""+Granify.matching+"/javascript/orders/update",Granify.POST(t,e,function(){return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(e){return Granify.removeUnconfirmedOrder(e)})},function(){return Granify.POST(t,e,function(){return Granify.getSharedData(Granify.storage.LAST_ORDER).then(function(e){return Granify.removeUnconfirmedOrder(e)})})}),Granify.getSharedData(Granify.storage.LAST_GA_FAST_ORDER).then(function(t){if(t!==e.order_number&&Granify.SESSION_INITIALIZED===1&&!e.track_ga)return Granify.sendGaOrder(e)}),Granify.setSharedData(Granify.storage.LAST_ORDER,e.order_number),Granify.trackCart(!1)):Granify.Promise.reject()})["catch"](function(){})}catch(n){return t=n,Granify.error(t,"trackOrder")}})},Granify.removeUnconfirmedOrder=function(e){return Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var n,r,i,s,o;i=t||[];for(n=s=0,o=i.length;s<o;n=++s){r=i[n];if(r.order_number===e){i.splice(n,1);break}}return i.length===0&&(Granify.hasUnconfirmedOrders=!1),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,i)})},Granify.resendUnconfirmedOrders=function(t){var n,r;return n=t!=null?JSON.parse(t):[],r=[],Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(t){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;c=t||[];for(p=0,m=c.length;p<m;p++)o=c[p],(b=o.order_number,e.call(function(){var e,t,n;n=[];for(e=0,t=r.length;e<t;e++)o=r[e],n.push(o.order_number);return n}(),b)<0)&&r.push(o);f=!1,l=[],s=4,h=11;if(r!=null&&r.length>0){for(i=d=0,g=r.length;d<g;i=++d)o=r[i],o["resent_tries"]==null&&(o.resent_tries=0),(w=o.order_number,e.call(n,w)>=0)||o.resent_tries>s?(l.push(i),f=!0):(o.last_resent_date?u=(+(new Date)-o.last_resent_date)/1e3:u=(+(new Date)-o.client_order_date)/1e3,a=h+(o.resent_tries+1)*3*3,u>a&&(f=!0,o.last_resent_date=+(new Date),o.resent_tries=o.resent_tries+1,o["order_date"]==null&&(o.order_date=parseInt(o.client_order_date)-Granify.clientTimeOffset),o["uuid"]==null&&Granify.getSharedData(Granify.storage.UUID).then(function(e){return Granify.UUID||e}),o["session"]==null&&Granify.getSharedData(Granify.storage.SESSION).then(function(e){return Granify.SESSION||e}),Granify.POST(""+Granify.matching+"/javascript/orders/update",o)));for(v=0,y=l.length;v<y;v++)i=l[v],r.splice(i,1);(f||r.length!==c.length)&&Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,r);if(r.length===0)return Granify.hasUnconfirmedOrders=!1}})})}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p;Granify.enabled&&(r=function(e){return Granify.isNumber(e)&&(e=e.toString()),e},s=function(e){return Granify.isString(e)&&parseFloat(e)==e&&(e=parseFloat(e)),Granify.isNumber(e)&&(e=e.toFixed(4),e=Granify.safeCastToFloat(e)),e},u=function(e,n,r){return n!=null?n=s(n):n=s(t(e)),a(n)&&n>=r?n:(Granify.log("item.regular_price should be Number and greater than current price.",{price:r,regular_price:n}),null)},o=function(e){return Granify.isString(e)&&Number(e)==e&&(e=Number(e)),e},i=function(e){if(typeof e!="undefined"&&e!==null)return Granify.isString(e)?e:(Granify.log("item.image should be String"),null)},n=function(e){return typeof e!="undefined"&&e!==null&&Granify.isString(e)},h=function(e){return Granify.isString(e)},a=function(e){return Granify.isNumber(e)&&e>=0},f=function(e){return Granify.isInteger(e)&&e>=0},t=function(e){var t;return t=Granify.getProduct(e,"regular_price"),t!=null?t:(Granify.log("getRegularPriceFromTrackProduct - Could not find regular_price. trackProduct data missing.",{item_id:e}),null)},e=function(e){var t,n,r;return r={},(t=i(e.image))!=null&&(r.image=t),(n=u(e.id,e.regular_price,e.price))!=null&&(r.regular_price=n),r},c=function(t){var i;return i=!1,t.id=r(t.id),t.price=s(t.price),t.quantity=o(t.quantity),n(t.id)?h(t.title)?a(t.price)?f(t.quantity)?(i=e(t),i.id=t.id,i.title=t.title,i.price=t.price,i.quantity=t.quantity):Granify.log_error("Cart_error",{message:"item.quantity not found or invalid",item:t}):Granify.log_error("Cart_error",{message:"item.price not found or invalid",item:t}):Granify.log_error("Cart_error",{message:"item.title not found or invalid",item:t}):Granify.log_error("Cart_error",{message:"item.id not found or invalid",item:t}),i},l=function(e){var t,n,r,i,s,o;if(!Granify.isObject(e)||!Granify.isArray(e.items))return Granify.log_error("Cart_error",{message:"Called with invalid parameter",param:e}),!1;t=[],o=e.items;for(i=0,s=o.length;i<s;i++){n=o[i];if(typeof n=="undefined"||n===null)continue;r=c(n),r&&t.push(r)}return t},Granify.trackCart=function(e){var t;Granify.log("GRANIFY - trackCart() called with: ",e),Granify.isBoolean(e)&&e===!1&&(e={items:[]}),Granify.isArray(e)&&(e={items:e}),t=l(e);if(t&&t.length===e.items.length){p(t,!0),Granify.setCartSSDProperty(t),Granify._granifySendCart={items:t};if(Granify.isNumber(e.price))return Granify._granifySendCart.total=e.price}},Granify.addToCart=function(e){var t;Granify.log("GRANIFY - addToCart() called with: ",e),Granify.isArray(e)&&(e={items:e}),t=l(e);if(t.length>0)return p(t),Granify.setCartSSDModifierProperty(t),Granify._granifyAddToCart={items:t}},p=function(e,t){var n,r,i,s,o,u;t==null&&(t=!1),i=Granify.getProductStorage(),s=t?{}:i.all_products_in_cart;for(o=0,u=e.length;o<u;o++)n=e[o],r=i.all_tracked_products[n.id]||i.all_products_in_cart[n.id],Granify.isObject(r)&&(s[n.id]=r);return i.all_products_in_cart=s,Granify.saveProductStorage(i)},Granify.deleteFromCart=function(e){var t,i,s,u,a,l;Granify.log("GRANIFY - deleteFromCart() called with: ",e),Granify.isArray(e)&&(e={items:e});if(!Granify.isObject(e)||!Granify.isArray(e.items)){Granify.log_error("Cart_error",{message:"Called with invalid parameter",param:e});return}t=[],l=e.items;for(u=0,a=l.length;u<a;u++)i=l[u],i.id=r(i.id),i.quantity=o(i.quantity),n(i.id)?f(i.quantity)?(s={id:i.id,quantity:i.quantity},t.push(s)):Granify.log_error("Cart_error",{message:"item.quantity not found or invalid",item:i}):Granify.log_error("Cart_error",{message:"item.id not found or invalid",item:i});if(t.length>0)return Granify._granifyDeleteFromCart={items:t}})}.call(this),function(){function n(e){var t=o(e);if(t)return Granify.log_error("trackProduct - Invalid product object format",{errorType:t,product:e},!0),!1;var n=u(e);n.length>0&&Granify.log_error("trackProduct - One or more invalid product fields",{fields:n,product:e},!0);for(var r in n)delete e[n[r]];return e}function r(e,t){var n=e.id,r=t.all_tracked_products[n];if(!r)r={};else{var i=t.recent_products.indexOf(n);t.recent_products.splice(i,1)}t.recent_products.push(n),Object.keys(e).forEach(function(t,n){r[t]=e[t]}),t.all_tracked_products[n]=r}function i(t){while(t.recent_products.length>e){var n=t.recent_products.shift();delete t.all_tracked_products[n]}}function o(e){var t=null;return Granify.isObject(e)?(Granify.isNumber(e.id)&&(e.id=""+e.id),!t&&!a(e.id)&&(t="id")):t="(object)",t}function u(e){var t=[],n={regular_price:"Float",image:String,category:String,sub_category:String,discount_eligible:Boolean,inventory_eligible:Boolean};a(e.title)||t.push("title"),Granify.isString(e.price)&&(e.price=Granify.safeCastToFloat(e.price)),!Granify.isNumber(e.price)||e.price<0?t.push("price"):e.price<0&&t.push("price");for(var r in n)typeof e[r]!="undefined"&&(n[r]===String?a(e[r])||t.push(r):n[r]===Boolean?Granify.isBoolean(e[r])||t.push(r):n[r]==="Float"&&(Granify.isString(e[r])&&(e[r]=Granify.safeCastToFloat(e[r])),(!Granify.isNumber(e[r])||e[r]<0)&&t.push(r)));return t}function a(e){return Granify.isString(e)&&e.trim()!==""}function f(e){return e=Granify.isInteger(e)?""+e:e,a(e)||(e=null),e}function l(e){return e!==null&&typeof e!="undefined"}Granify._currentProduct=null;var e=100;Granify.localStorageWorking||(Granify.locallyTrackedProducts=[]),Granify.initializeTrackProductRollingWindow=function(t){e=Granify.isInteger(t)&&t>0?t:e};var t=function(e){var t=!1;e.forEach(function(e){t=s(e)}),e.length==1&&t&&Granify.setCurrentProduct(e[0].id)};Granify.trackProduct=function(e){Granify.log("GRANIFY - trackProduct() called with: ",e),Granify.isObject(e)&&o(e)==null&&(e=[e]);if(!Granify.isArray(e)||e.length==0){Granify.log_error("trackProduct - Expected list of products",e);return}if(!Granify.localStorageWorking)t(e);else{var n=Granify.getProductStorage(),r=!1;e.forEach(function(e){r=Granify._trackOneProduct(e,n)}),Granify.saveProductStorage(n),e.length==1&&r&&Granify.setCurrentProduct(e[0].id)}};var s=function(t){return t=n(JSON.parse(JSON.stringify(t))),t?(Granify.locallyTrackedProducts.push(t),Granify.locallyTrackedProducts.length>e&&Granify.locallyTrackedProducts.shift(),!0):!1};Granify._trackOneProduct=function(e,t){return e=n(JSON.parse(JSON.stringify(e))),e?(r(e,t),i(t),!0):!1},Granify.getProductStorage=function(){return{all_tracked_products:Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT)||{},all_products_in_cart:Granify.synchronousGetSharedData(Granify.storage.TRACKED_CART_PRODUCTS)||{},recent_products:Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT_ROLLING_WINDOW)||[]}},Granify.saveProductStorage=function(e){Granify.setSharedData(Granify.storage.TRACK_PRODUCT_ROLLING_WINDOW,e.recent_products),Granify.setSharedData(Granify.storage.TRACKED_CART_PRODUCTS,e.all_products_in_cart),Granify.setSharedData(Granify.storage.TRACK_PRODUCT,e.all_tracked_products)},Granify.setCurrentProduct=function(e){Granify.log("GRANIFY - setCurrentProduct() called with: ",e);var t=f(e);t!==null?(Granify._currentProduct=t,Granify.trigger("currentproduct:change")):Granify.log_error("setCurrentProduct - invalidProductId",e)},Granify.getCurrentProduct=function(e){var t=null;return Granify._currentProduct===null?Granify.log_error("setCurrentProduct - notCalled",e):t=Granify.getProduct(Granify._currentProduct,e),t},Granify.getProduct=function(e,t){var n=f(e);if(n===null)return Granify.log_error("getProduct - invalidProductId",e),null;if(!a(t))return Granify.log_error("getProduct - invalidField",t),null;var r;if(Granify.localStorageWorking){var i=Granify.getProductStorage();r=i.all_tracked_products[n]||i.all_products_in_cart[n]}else r=Granify.locallyTrackedProducts.filter(function(t){return t.id===e})[0];return typeof r=="undefined"?null:typeof r[t]=="undefined"?null:r[t]}}.call(this),function(){Granify.enabled&&(Granify.trackPageView=function(e){var t;Granify.log("GRANIFY - trackPageView() called with: ",e),Granify.testDebug("Execute Granify.trackPageView("+JSON.stringify(e)+")");if(e==null)return Granify.log_error("Granify.trackPageView: no data passed. Requests object with page_type");Granify.pageMetaData=null,Granify.isString(e.page_type)?(e.page_type=e.page_type.toLowerCase().replace(/[^A-Za-z]/g,""),e.page_type==="missing"||e.page_type.length<=0?Granify.log_error('Granify.trackPageView: page_type should not be "missing" or be blank or be all numbers.'):(Granify.pageType=e.page_type,Granify.trigger("pagetype:change"))):Granify.log_error("Granify.trackPageView requires page_type with String page type");if(e.product==null&&e.category==null&&e.subcategory==null)return;return t={},e.category!=null&&(t.c=e.category),e.subcategory!=null&&(t.sc=e.subcategory),e.product!=null&&(t.p=Granify.compact_object(e.product)),Granify.pageMetaData=t,Granify.trigger("pagemeta:change")},Granify.checkPageType=function(){return Granify.pageType!=null?Granify.pageType:Granify.pageType=Granify.getPageType()},Granify.getPageMetaData=function(){return Granify.pageMetaData},Granify.getPageType=function(){return Granify.pageType||"missing"},Granify.resetPageType=function(){return Granify.pageType=null,Granify.pageMetaData=null})}.call(this),function(){Granify.enabled&&(Granify.identify=function(e){return Granify.reloadFlags(function(){var t;try{return e.site_id=Granify.SHOP_ID,e.uuid=Granify.UUID,e.session=Granify.SESSION,Granify.POST(""+Granify.matching+"/javascript/users/identify",e)}catch(n){return t=n,Granify.error(t,"identify"),!1}})})}.call(this),function(){var e;Granify.enabled&&(e="GranifyCID",Granify._checkForceMatchingQuery=function(t){var n;t==null&&(t=window);if(Granify.use_iframe!=null&&Granify.use_iframe){Granify.log("Preview URL Force Matching not supported on iFrame installations");return}n=Granify.getParam(e,null,t.location.search),n=Number(n);if(Granify.isNumber(n)&&n>0)return Granify.setSharedData(Granify.storage.FORCE_MATCHING,n),Granify.removeQueryParamFromUrl(e,t),Granify._sendResetSessionFlag=!0},Granify._getForceMatchingCid=function(){var e;return Granify.use_iframe!=null&&Granify.use_iframe?null:(e=Number(Granify.synchronousGetSharedData(Granify.storage.FORCE_MATCHING)),Granify.isNumber(e)&&e>0?e:null)},Granify._getAndClearResetSessionFlag=function(){return Granify._sendResetSessionFlag===!0?delete Granify._sendResetSessionFlag:null})}.call(this),function(){var e,t,n,r,i,s;if(Granify.enabled){Granify.tracking_stopped=!1,Granify.tracking_initialized=!1,Granify.campaign=null,Granify.old_offer=null,Granify.group="unknown",Granify.matching=Granify.rb.matching_host,Granify.test_mode=!1,Granify.rb.environment("test")&&(Granify.test_mode=!0),Granify.tracking_wait_interval=1e3,Granify.matching_requests=[],Granify.version=Granify.rb.version,Granify.getSharedData(Granify.storage.THROW_ERRORS).then(function(e){if(e)return Granify.throw_errors=!0}),Granify.errors=[],Granify.testsDebugMessages=[],Granify.hasUnconfirmedOrders=!1,Granify.latency={},Granify.latency.mutex=!1,Granify.match_timeout=null,Granify.resetSources=[],Granify.rb.get_analytics(),Granify._functionsAvailable=!0,Granify.start=function(){return addGranifyListener(GLOBAL,"beforeunload",function(){var e;try{Granify.stop()}catch(t){e=t}}),Granify.testDebug("Execute Granify.start()"),Granify.isMutexLocked()||(Granify.lockMutex(),Granify.acquiredMutex=!0),setTimeout(function(){var e,t,n,r,i;Granify._stack==null&&(Granify._stack=[]),r=Granify._stack,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e[0]==="trackOrder"?i.push(Granify[e[0]](e[1],!0)):i.push(void 0);return i},0),Granify.reset("start"),Granify.idle_watch=setInterval(function(){return Granify.testDebug("Execute Granify.idle_watch"),Granify.idle_tracking()},1e3),setTimeout(function(){return Granify.acquiredMutex?(Granify.testDebug("Mutex aquired!"),Granify.onPageLoad()):(Granify.testDebug("Mutex not aquired!"),Granify.waitForMutex(function(){return Granify.onPageLoad()}))},0)},Granify.onPageLoad=function(){return GLOBAL.document.readyState==="complete"||Granify.is_ie&&GLOBAL.document.readyState==="interactive"?Granify.init():(Granify.is_ie&&addGranifyListener(GLOBAL,"DOMContentLoaded",Granify.init),addGranifyListener(GLOBAL,"load",Granify.init))},Granify.init=function(){var e,t,n,r,i,s,o;if(this.wasInitialized)return;this.wasInitialized=!0,Granify.init_time=+(new Date),o=Granify.tracker_classes;for(i=0,s=o.length;i<s;i++)e=o[i],Granify.trackers.push(new e);Granify.use_iframe&&Granify.insertFrame(),Granify.enableSiteStateData();try{Granify.updateStateDataFromStorage()}catch(u){r=u,Granify.log_error("Granify.init - Could not update state data from Storage on load",{error_message:r.message},!0)}Granify.reloadFlags(function(){return Granify.acquiredMutex&&Granify.releaseMutex(),Granify.initializeMatching()}),Granify.trigger("granify:init");try{t=Granify.getStorage(Granify.storage.BOOKMARKLET),Granify.paramExists("granify_preview",[location.href,GLOBAL.document.referrer])&&(Granify.previewMode=!0);if(t==="open"||Granify.previewMode)return Granify.insertScript(""+Granify.domain+"/install-bookmarklet.js",function(){},"granify-bookmarklet-script")}catch(u){n=u}},Granify.initializeMatching=function(){var e,t;Granify.testDebug("Execute Granify.initializeMatching()"),Granify._stack==null&&(Granify._stack=[]);while(e=Granify._stack.shift())t=e.shift(),Granify[t].apply(null,e);return Granify.match()},Granify.stop=function(){var e,t,n,r;Granify.stopped=!0,Granify.tracking_stopped=!0,r=Granify.trackers;for(t=0,n=r.length;t<n;t++)e=r[t],e.stop();return Granify.trackers=[]},Granify.resetLocal=function(){var e,t,n,r;Granify.testDebug("Executing Granify.resetLocal: "+arguments.callee.caller.toString()),Granify.page_visit=0,Granify.start_time=+(new Date),Granify.start_time_fixed=Granify.start_time,Granify.cumulated_active_time=0,Granify.mouse_activity_resumed_date=Granify.start_time_fixed,Granify.mouse_active_time_total=0,Granify.idle_time=0,Granify.current_time=null,r=Granify.trackers;for(t=0,n=r.length;t<n;t++)e=r[t],e.reset();return Granify.eraseSharedData(Granify.storage.ENTRY_PAGE_SENT),Granify.eraseSharedData(Granify.storage.ENTRY_REFERRER_SENT),Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then(function(e){if(e!=null&&e!==""&&e.length!==0)return Granify.hasUnconfirmedOrders=!0}),Granify.latestSentData=null,Granify._check_debug_query(),Granify._checkForceMatchingQuery()},Granify.reset=function(e){return e==null&&(e="unknown"),Granify.testDebug("Executing Granify.reset: "+arguments.callee.caller.toString()+")"),Granify.resetSources.length<10&&Granify.resetSources.push(e),Granify.resetLocal(),Granify.data=null,Granify.tags=[],Granify.location=GLOBAL.location.href,Granify.resetPageType()},Granify.track=Granify.throttle(function(){var e,t;Granify.testDebug("Execute Granify.track()"),t=(new Date).getTime(),Granify.page_visit+=(t-Granify.start_time)/1e3,Granify.start_time=t;try{Granify.reloadFlags(function(){return Granify.match()})}catch(n){e=n,Granify.error(e,"match")}return!0},100),Granify.scheduleNextMatch=function(){Granify.testDebug("Execute Granify.scheduleNextMatch()");if(!Granify.tracking_stopped)return setTimeout(function(){return Granify.track()},Granify.tracking_wait_interval)},Granify.idle_tracking=Granify.throttle(function(){Granify.testDebug("Execute Granify.idle_tracking()"),Granify.idle_time+=1;if(Granify.stopped)return;Granify.idle_time>5&&!Granify.tracking_stopped?(Granify.tracking_stopped=!0,Granify.cumulated_active_time+=Granify.time_since(Granify.mouse_activity_resumed_date)):Granify.tracking_stopped&&Granify.idle_time<=5&&(Granify.tracking_stopped=!1,Granify.mouse_activity_resumed_date=+(new Date),Granify.scheduleNextMatch());if(!Granify.tracking_stopped)return Granify.mouse_active_time_total=Granify.cumulated_active_time+Granify.time_since(Granify.
mouse_activity_resumed_date)},100),Granify.handleOffer=function(e){var t;if(Granify.stopped)return;try{if((e!=null?e.tg:void 0)==null||e.se!=null&&e.se===1)return Granify.SESSION_INITIALIZED=2,Granify.stop(),!1;Granify.SESSION_INITIALIZED=1,e.tg?(Granify.trigger("test_group"),Granify.sendGaGroup("baseline"),Granify.group="baseline"):(Granify.sendGaGroup("granify"),Granify.trigger("granify_group"),Granify.group="granify"),e.debug&&Granify.showDebug(e);if(e.cg)return Granify.trigger("control_group"),!0;if(e.campaign){if(JSON.stringify(e.campaign)===JSON.stringify(Granify.old_offer))return Granify.updateWidget(e),!0;Granify.current_coupon&&Granify.current_coupon.remove(),Granify.campaign=e.campaign,Granify.old_offer=e.campaign,Granify.latency.mutex=!0,Granify.loadWidget(e)}return!0}catch(n){return t=n,Granify.error(t,"handleOffer"),!1}},Granify.updateWidget=function(e){var t;return t={shared_user_data:e.sud,shared_offer_data:e.sod,widget_state_data:e.wsd},Granify.current_coupon&&Granify.current_coupon.loadSharedData(t),!0},Granify.loadWidget=function(e){return Granify.initCoupon(function(){var t,n,r,i,s,o;try{i=e.campaign.campaign_type;switch(i){case"discount":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"percent":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"shipping":o="",t=e.campaign.offer.coupon;break;default:o="",t=""}return r={id:e.campaign.id,type:i,headline:e.campaign.outcome.headline,message:e.campaign.outcome.text,style:e.campaign.outcome.style,locale:e.campaign.outcome.locale,amount:o,coupon:t,experiment:e.campaign.experiment,force_matching:e.force_matching,shared_user_data:e.sud,shared_offer_data:e.sod,widget_state_data:e.wsd},e.custom_url!=null?s=e.custom_url:s=""+Granify.domain+"/custom_assets/widget/"+r.experiment+".js",Granify.insertScript(s,function(){var e;return e=new Granify.widget_class(r),e.initialize(),Granify.latency.offer_shown=+(new Date)})}catch(u){return n=u,Granify.error(n,"loadWidget"),!1}})},Granify.touchSession=function(){var e,t;return t=Granify.getSessionExpiration(),Granify.setSharedData(Granify.storage.SESSION,Granify.SESSION,t),e=[],e.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),e.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),Granify.Promise.all(e).then(function(e){var n,r;n=e[0],r=e[1],n&&Granify.setSharedData(Granify.storage.ENTRY_PAGE,n,t);if(r)return Granify.setSharedData(Granify.storage.ENTRY_REFERRER,r,t)})},Granify.reloadFlags=function(e){var t;if(Granify.previewMode)return;t=[],t.push(Granify.getSharedData(Granify.storage.UUID)),t.push(Granify.getSharedData(Granify.storage.SESSION)),Granify.Promise.all(t).then(function(t){var n,r;return r=t[0],n=t[1],r&&!Granify.sessionHasExpired()?(Granify.UUID=r,Granify.isNewSession=!1,n==null?(Granify.SESSION_INITIALIZED=0,Granify.resetLocal(),Granify.SESSION=parseInt(Granify.start_time_fixed),Granify.isNewSession=!0):(Granify.SESSION_INITIALIZED=1,Granify.SESSION=parseInt(n),Granify.isNewSession=!1),Granify.touchSession(),e()):Granify.stop()})},Granify.match_function=function(){var e,t,n,r,i,s,o,u,a,f;if(Granify.stopped)return;Granify.testDebug("Execute Granify.match()");if(Granify.previewMode){Granify.stop();return}clearTimeout(Granify.match_timeout);if(!Granify.SHOP_ID||!Granify.UUID||!Granify.SESSION||Granify.SESSION_INITIALIZED==null){Granify.match_timeout=setTimeout(function(){return Granify.track()},100);return}if(!Granify.UUID.match(/^[0-9A-Fa-f-]+$/)){Granify.log_error("Wrong UUID format",{x:Granify.version.js,domain:Granify.cookies_domain,uuid:JSON.stringify(Granify.UUID)}),Granify.setSharedData(Granify.storage.UUID,"");return}if(Granify.lastScroll&&new Date-Granify.lastScroll<500){Granify.match_timeout=setTimeout(function(){return Granify.track()},1e3);return}Granify.isLocationChanged(Granify.location)&&Granify.reset("locationChanged"),Granify.checkPageType(),Granify.touchSession(),Granify.mouse_active_time_total!=null?r=Granify.round(Granify.mouse_active_time_total):r=0,e={uuid:Granify.UUID,session:Granify.SESSION,site_id:Granify.SHOP_ID,start_time:Granify.start_time_fixed,visit_duration:Granify.page_visit!=null?Granify.round(Granify.page_visit):0,page_type:Granify.getPageType(),tags:Granify.tags,mouse_active_time:r,x:Granify.version.js},Granify.isNewSession&&(e.nse=Granify.isNewSession),Granify.getPageMetaData()!=null&&(e.page_meta_data=JSON.stringify(Granify.getPageMetaData())),Granify._granifySendCart!=null&&(e.cart_contents=Granify._granifySendCart,Granify._granifySendCart=null),Granify._granifyAddToCart!=null&&(e.add_to_cart=Granify._granifyAddToCart,Granify._granifyAddToCart=null),Granify._granifyDeleteFromCart!=null&&(e.delete_from_cart=Granify._granifyDeleteFromCart,Granify._granifyDeleteFromCart=null),e.ssd=JSON.stringify(Granify.getSSD()),e.ssd.length>Granify.getSSDLimit()&&(Granify.log_error("site_state_data exceeds size limit allowed by Matching; not sending data.",{string_length:e.ssd.length}),e.ssd=JSON.stringify(null)),Granify.clearSSD(),e.ssd_m=JSON.stringify(Granify.getSSD_M()),e.ssd_m.length>Granify.getSSDLimit()&&(Granify.log_error("site_state_data (modifier) exceeds size limit allowed by Matching; not sending data.",{string_length:e.ssd_m.length}),e.ssd_m=JSON.stringify(null)),Granify.clearSSD_M(),e.wsd=JSON.stringify(Granify.getWSD()),e.wsd.length>Granify.getWSDLimit()&&(Granify.log_error("widget_state_data exceeds size limit allowed by Matching; not sending data.",{string_length:e.wsd.length}),e.wsd=JSON.stringify(null)),Granify.clearWSD(),f=Granify.trackers;for(u=0,a=f.length;u<a;u++){s=f[u],t=s.getData();for(n in t)o=t[n],e[n]=o}return Granify.hasUnconfirmedOrders&&(e.has_unconfirmed_orders=+Granify.hasUnconfirmedOrders),Granify.ga==null&&(Granify.ga=JSON.stringify(Granify.packObj(Granify.getGaAttributes()))),e.ga=Granify.ga,Granify.data&&(e.data=JSON.stringify(Granify.data),Granify.data=null),Granify.latency.mutex&&Granify.latency.offer_shown&&(e.widget_latency_full=Granify.latency.offer_shown-Granify.latency.last_request_sent,e.widget_latency_js=Granify.latency.offer_shown-Granify.latency.last_request_response,Granify.latency.mutex=!1,Granify.latency.offer_shown=null),i=[],i.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),i.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE_SENT)),i.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),i.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER_SENT)),Granify.Promise.all(i).then(function(t){var n,r,i,s,o,u,a,f,l;return n=t[0],r=t[1],i=t[2],s=t[3],n&&!r&&(e.entry_page=n),i&&!s&&(e.entry_referrer=i),(o=Granify._getForceMatchingCid())!=null&&(e.force_matching=o),(a=Granify._getAndClearResetSessionFlag())!=null&&(e.reset_session=a),Granify.current_time!=null?Granify.current_time=parseInt(+(new Date).getTime()/1e3):Granify.current_time=e.start_time,e!=null&&(e.current_time=Granify.current_time),Granify.timeSinceStart==null&&(typeof performance!=="undefined"&&performance!==null?(f=performance.timing)!=null?f.navigationStart:void 0:void 0)!=null&&(Granify.timeSinceStart=Granify.current_time-performance.timing.navigationStart,e.time_since_start=Granify.timeSinceStart),Granify.timeSinceDom==null&&(typeof performance!=="undefined"&&performance!==null?(l=performance.timing)!=null?l.domLoading:void 0:void 0)!=null&&(Granify.timeSinceDom=Granify.current_time-performance.timing.domLoading,e.time_since_dom=Granify.timeSinceDom),u=Granify.packObj(Granify.removeUnchangedData(e)),Granify.latency.mutex||(Granify.latency.last_request_sent=+(new Date)),Granify.testDebug("Send data to Goliath: "+JSON.stringify(u)),Granify.POST(""+Granify.matching+"/match",u,function(t){var n;Granify.latency.mutex||(Granify.latency.last_request_response=+(new Date));if(t.error==null){t.st!=null&&t.st!==Granify.start_time_fixed&&(n=!0),Granify.testDebug("Received data from Goliath: "+JSON.stringify(t)),Granify.latestSentData=e,e.entry_page&&Granify.setSharedData(Granify.storage.ENTRY_PAGE_SENT,"1"),e.entry_referrer&&Granify.setSharedData(Granify.storage.ENTRY_REFERRER_SENT,"1"),t.ct&&(Granify.lastServerTime=t.ct,Granify.clientTimeOffset=parseInt(+(new Date).getTime()/1e3)-parseInt(Granify.lastServerTime),Granify.setSharedData(Granify.storage.LAST_SERVER_TIME,{time:Granify.lastServerTime,session:Granify.SESSION})),Granify.hasUnconfirmedOrders&&Granify.resendUnconfirmedOrders(t.co);if(Granify.previewModeWithMatching||n)return Granify.scheduleNextMatch();if(Granify.handleOffer(t))return Granify.scheduleNextMatch()}})})},Granify.match=Granify.throttle(Granify.match_function,Granify.tracking_wait_interval),Granify.testDebug("Before Granify.start()"),Granify.addErrorHandling(Granify),n=[],s=Granify._stack;for(r=0,i=s.length;r<i;r++)e=s[r],e[0]==="error"||e[0]==="log_error"?(t=e.shift(),Granify[t].apply(null,e)):n.push(e);Granify._stack=n,!Granify.use_iframe&&!Granify.use_local_storage&&!Granify.use_cookies?(Granify.log("Disabling Granify library, no storage option available"),Granify.enabled=!1,Granify.stop()):Granify.start()}}.call(this),function(){Granify.enabled&&(Granify.send_validation_errors=!0)}.call(this);

(function () {

    var _original_trackCart = Granify.trackCart;
    Granify.trackCart = function (data) {
      if(Granify.isBoolean(data) && data){
        data = {
          items : [
            {
              id: "Flight",
              quantity: 1,
              price: 1,
              regular_price: 1,
              title: "Flight Item"
            }
          ]
        };
        try{
          // Set the price if we can find it but otherwise don't worry.
          var priceElements = document.getElementsByClassName('totalPackage');
          if(priceElements.length > 0){
            var textPrice = priceElements[0].textContent.replace(',','');
            var flightPrice = Number(textPrice);
            data.items[0].price = flightPrice;
            data.items[0].regular_price = flightPrice;
          }
        } catch (err) {

        }
      }
      _original_trackCart(data);
    };

    (function(){

  function isPage(pageTypes){
    for(var i=0; i < pageTypes.length; i++){
      if(pageTypes[i] === Granify.getPageType()){
        return true;
      }
    };
    return false;
  };

  function setSiteStateDataPropertyByPage(property, value, pageTypeArray){
    if (isPage(pageTypeArray)) {
      Granify.setSiteStateDataProperty(property, value);
    } else {
      Granify.setSiteStateDataProperty(property, null);
    };
  };

  // Resulting Granify date format expected: YYYY-MM-DD
  function validDateFormat(dateString){
    var dateCheckRegex = /[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}/g
    var matches = dateString.match(dateCheckRegex);
    return matches.length == 1
  }

  // Original date string format: MM/DD/YYYY
  function formatDateString(dateString) {
    if (typeof dateString === "undefined" || dateString === null) {
      return null;
    }
    if (!Granify.isString(dateString)) {
      Granify.log_error("Flight date formatting is not expected type: string.", dateString);
      return null;
    };
    if (dateString === "") {
      // Return flight date can be defined as "" in one-way flight settings.
      return null;
    };
    var dateObject = dateString.split(/[\s\/-]+/);
    if (dateObject.length != 3) {
      Granify.log_error("Flight date formatting cannot be split into exactly 3 sections.", dateString);
      return null;
    };
    
    var flightYear = "";
    var flightDay = "";
    var flightMonth = "";

    try{
      flightMonth = Number(dateObject[0]);
      flightDay = Number(dateObject[1]);
      flightYear = Number(dateObject[2]);
    } catch (err) {
      Granify.log_error("Flight data unable to be converted into numbers.", dateString);
      return null;
    }

    if(flightYear < new Date().getFullYear()){
      Granify.log_error("Flight date is in a previous year.", dateString);
      return null;
    }
    if(flightDay < 1 || flightDay > 31){
      Granify.log_error("Flight date is in an invalid day range.", dateString);
      return null;
    }
    if(flightMonth < 1 || flightMonth > 12){
      Granify.log_error("Flight date is in an invalid month range.", dateString);
      return null;
    }
    var formattedDate = flightYear + "-" + flightMonth + "-" + flightDay;
    if (!validDateFormat(formattedDate)) {
      Granify.log_error("Flight date formatting is not the expected format. Original:" + dateString + " Formatted: " + formattedDate);
      return null;
    };
    return formattedDate;
  };

  Granify.onEvery('pagetype:change', function(){
    setSiteStateDataPropertyByPage(
      'cp_promo_price_count',
      document.getElementsByClassName('promotetxt').length,
      ['flights']
    );
    setSiteStateDataPropertyByPage(
      'cp_total_flight_upgrades_available',
      document.getElementsByClassName('btn_td3').length,
      ['flights']
    );
    // cp_meals_available is expected as a number.
    if (document.getElementById('MLCH_price') != null) {
      var mealsAvailable = 1
    };
    setSiteStateDataPropertyByPage(
      'cp_meals_available',
      mealsAvailable,
      ['guestdetails']
    );
    setSiteStateDataPropertyByPage(
      'cp_departure_date',
      formatDateString(page_data.s_departure_date),
      ['flights', 'guestdetails', 'preferences', 'checkout']
    );
    setSiteStateDataPropertyByPage(
      'cp_return_date',
      formatDateString(page_data.s_return_date),
      ['flights', 'guestdetails', 'preferences', 'checkout']
    );
  });

})();


}).call(this);

